<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket AI Trading Bot - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #F8F9FA; /* Clean white/gray background */
            min-height: 100vh;
            padding: 0;
            color: #1A1A1A; /* Black/gray text */
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #003D99 0%, #0066FF 50%, #338EFF 100%);
            border-radius: 20px;
            padding: 60px 40px;
            margin-bottom: -80px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 102, 255, 0.3);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .hero-title {
            font-size: 3.5em;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.4em;
            color: rgba(255,255,255,0.9);
            margin-bottom: 40px;
            font-weight: 300;
        }

        .hero-portfolio {
            display: inline-block;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px 60px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .hero-portfolio-label {
            font-size: 0.9em;
            color: rgba(255,255,255,0.8);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .hero-portfolio-value {
            font-size: 4.5em;
            font-weight: 800;
            color: white;
            line-height: 1;
            margin-bottom: 10px;
            text-shadow: 0 2px 20px rgba(0,0,0,0.3);
        }

        .hero-portfolio-change {
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .hero-portfolio-change.positive {
            color: #10b981;
        }

        .hero-portfolio-change.negative {
            color: #fca5a5;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5em;
            }
            .hero-subtitle {
                font-size: 1.1em;
            }
            .hero-portfolio-value {
                font-size: 3em;
            }
            .hero-section {
                padding: 40px 20px;
                margin-bottom: -60px;
            }
        }

        .header {
            background: #FFFFFF; /* White background */
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #F1F3F5; /* Light gray border */
        }

        .header h1 {
            color: #0066FF; /* Professional blue */
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #6B7280; /* Gray text */
            font-size: 1.1em;
        }

        .status-bar {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .status-item {
            background: #F8F9FA;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #F1F3F5;
            color: #1A1A1A;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Left Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 260px;
            background: #FFFFFF;
            border-right: 1px solid #F1F3F5;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar.closed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #F1F3F5;
            background: linear-gradient(135deg, #003D99 0%, #0066FF 100%);
            color: white;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 700;
        }

        .sidebar-nav {
            padding: 10px 0;
        }

        .nav-item {
            display: block;
            padding: 14px 20px;
            color: #1A1A1A;
            text-decoration: none;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #F8F9FA;
            color: #0066FF;
            border-left-color: #0066FF;
        }

        .nav-item.active {
            background: #E6F0FF;
            color: #0066FF;
            border-left-color: #0066FF;
            font-weight: 700;
        }

        /* Hamburger Menu Button */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #0066FF;
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.3em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .menu-toggle:hover {
            background: #003D99;
            transform: scale(1.05);
        }

        /* Main Content Area (with sidebar) */
        .main-wrapper {
            display: flex;
            margin-left: 260px;
            transition: margin-left 0.3s ease;
        }

        .main-wrapper.sidebar-closed {
            margin-left: 0;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            min-height: 100vh;
        }

        .content {
            background: #FFFFFF; /* White background */
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            border: 1px solid #F1F3F5; /* Light gray border */
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: #0066FF; /* Professional blue */
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #003D99; /* Dark blue on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 102, 255, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        input, select {
            padding: 12px;
            border: 1px solid #F8F9FA;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0066FF; /* Professional blue */
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #FFFFFF; /* White background */
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #F1F3F5; /* Light gray border */
            color: #1A1A1A; /* Black text */
        }

        th {
            background: #F8F9FA; /* Light gray header */
            font-weight: 600;
            color: #0066FF; /* Professional blue */
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #F8F9FA; /* Light gray on hover */
        }

        /* Quick Stats Widget */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
            margin-top: 100px;
            position: relative;
            z-index: 10;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-gradient, linear-gradient(90deg, #0066FF, #338EFF));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card.portfolio {
            --card-gradient: linear-gradient(90deg, #0066FF, #003D99);
        }

        .stat-card.positions {
            --card-gradient: linear-gradient(90deg, #10b981, #059669);
        }

        .stat-card.pnl {
            --card-gradient: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .stat-card.winrate {
            --card-gradient: linear-gradient(90deg, #0066FF, #003D99);
        }

        .stat-card.status {
            --card-gradient: linear-gradient(90deg, #10b981, #059669);
        }

        .stat-card h3 {
            font-size: 0.85em;
            color: #6B7280;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-card .value {
            font-size: 2.4em;
            font-weight: 800;
            color: #1A1A1A;
            display: block;
            margin-bottom: 8px;
            line-height: 1.1;
        }

        .stat-card .change {
            font-size: 0.9em;
            font-weight: 600;
        }

        .stat-card .change.positive {
            color: #10b981; /* emerald-500 */
        }

        .stat-card .change.negative {
            color: #ef4444; /* red-500 */
        }

        .stat-card .value.running {
            color: #10b981; /* emerald-500 */
            font-size: 1.2em;
        }

        .stat-card .value.running::before {
            content: '‚óè ';
            animation: pulse 2s infinite;
        }

        /* Settings Panel */
        .settings-panel {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid #F1F3F5;
        }

        .settings-panel h3 {
            color: #0066FF;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .setting {
            margin-bottom: 25px;
            padding: 15px;
            background: #F8F9FA;
            border-radius: 8px;
        }

        .setting label {
            display: block;
            font-weight: 600;
            color: #1A1A1A;
            margin-bottom: 10px;
        }

        .setting input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .setting input[type="number"] {
            width: 150px;
            margin-right: 10px;
        }

        .setting input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .setting span {
            color: #0066FF;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Activity Feed */
        .activity-feed {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #F1F3F5;
        }

        .activity-feed h3 {
            color: #0066FF;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .activity-feed ul {
            list-style: none;
            padding: 0;
        }

        .activity-feed li {
            background: #F8F9FA;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #0066FF;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .activity-feed li.trade {
            border-left-color: #10b981;
        }

        .activity-feed li.signal {
            border-left-color: #ffc107;
        }

        .activity-feed .time {
            color: #6B7280;
            font-size: 0.85em;
        }

        .activity-feed .action {
            font-weight: 600;
            color: #0066FF;
        }

        .activity-feed .market {
            flex: 1;
            min-width: 200px;
        }

        .activity-feed .amount,
        .activity-feed .edge {
            color: #10b981;
            font-weight: 600;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5; /* Light green background */
            color: #065f46; /* Dark green text */
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-danger {
            background: #fee2e2; /* Light red background */
            color: #991b1b; /* Dark red text */
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-warning {
            background: #fef3c7; /* Light yellow background */
            color: #92400e; /* Dark yellow text */
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-info {
            background: #dbeafe; /* Light blue background */
            color: #1e40af; /* Dark blue text */
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* Text utility classes for P&L and status indicators */
        .text-success {
            color: #10B981; /* Green for positive/profit */
        }

        .text-danger {
            color: #EF4444; /* Red for negative/loss */
        }

        .text-warning {
            color: #F59E0B; /* Yellow for warnings/neutral */
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6B7280;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0066FF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #FFFFFF; /* White background */
            color: #1A1A1A; /* Black text */
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #F1F3F5; /* Light gray border */
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #6B7280; /* Gray text */
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: 700;
            color: #1A1A1A; /* Black text */
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Market Cards */
        .markets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .market-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #F1F3F5;
            cursor: pointer;
        }

        .market-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border-color: #0066FF;
        }

        .market-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .market-category {
            font-size: 0.75em;
            color: #0066FF;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .market-question {
            font-size: 1.1em;
            font-weight: 700;
            color: #1A1A1A;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .market-probability {
            margin-bottom: 20px;
        }

        .market-probability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .market-probability-label {
            font-size: 0.85em;
            color: #6B7280;
            font-weight: 600;
        }

        .market-probability-value {
            font-size: 1.8em;
            font-weight: 800;
            color: #0066FF;
        }

        .market-probability-bar {
            width: 100%;
            height: 10px;
            background: #F1F3F5;
            border-radius: 10px;
            overflow: hidden;
        }

        .market-probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066FF, #338EFF);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .market-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #6B7280;
            margin-bottom: 20px;
            padding-top: 16px;
            border-top: 1px solid #F1F3F5;
        }

        .market-action-btn {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #0066FF, #003D99);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .market-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.4);
            background: linear-gradient(135deg, #338EFF, #0066FF);
        }

        /* Search and Filter Bar */
        .markets-search-bar {
            background: white;
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid #F1F3F5;
            border-radius: 10px;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #0066FF;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #6B7280;
            font-size: 1.2em;
        }

        .filter-btn {
            padding: 12px 24px;
            background: #f1f5f9;
            border: 2px solid #F1F3F5;
            border-radius: 10px;
            font-weight: 600;
            color: #475569;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn:hover {
            background: #F1F3F5;
            border-color: #cbd5e1;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
            }

            .main-wrapper {
                margin-left: 0;
            }

            .markets-grid {
                grid-template-columns: 1fr;
            }

            .markets-search-bar {
                flex-direction: column;
            }

            .search-input-wrapper {
                width: 100%;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }

            .hero-section {
                padding: 40px 20px;
                margin-bottom: -60px;
            }

            .header {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Hamburger Menu Button (Mobile) -->
    <button class="menu-toggle" onclick="toggleSidebar()" id="menu-toggle">‚ò∞</button>

    <!-- Left Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>PredictEdge</h2>
            <p style="margin: 5px 0 0 0; font-size: 0.85em; opacity: 0.9;">Trading Dashboard</p>
        </div>
        <div class="sidebar-nav">
            <a class="nav-item active" onclick="showTab('dashboard'); closeSidebar();">üè† Dashboard</a>
            <a class="nav-item" onclick="showTab('markets'); closeSidebar();">üìä Markets</a>
            <a class="nav-item" onclick="showTab('predictions'); closeSidebar();">üîÆ Predictions</a>
            <a class="nav-item" onclick="showTab('signals'); closeSidebar();">üì° Signals</a>
            <a class="nav-item" onclick="showTab('trades'); closeSidebar();">üíº Trades</a>
            <a class="nav-item" onclick="showTab('portfolio'); closeSidebar();">üí∞ Portfolio</a>
            <a class="nav-item" onclick="showTab('analytics'); closeSidebar();">üìà Analytics</a>
            <a class="nav-item" onclick="showTab('alerts'); closeSidebar();">üîî Alerts</a>
            <a class="nav-item" onclick="showTab('whales'); closeSidebar();">üêã Whale Tracker</a>
            <a class="nav-item" onclick="showTab('calendar'); closeSidebar();">üìÖ Economic Calendar</a>
            <a class="nav-item" onclick="showTab('settings'); closeSidebar();">‚öôÔ∏è Settings</a>
            <a class="nav-item" onclick="showTab('help'); closeSidebar();">‚ùì Help & FAQ</a>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper" id="main-wrapper">
        <div class="container">
            <!-- Hero Section - ONLY on Dashboard -->
            <div class="hero-section" id="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">PredictEdge</h1>
                <p class="hero-subtitle">AI-Powered Prediction Market Intelligence</p>
                <div class="hero-portfolio">
                    <div class="hero-portfolio-label">Portfolio Value</div>
                    <div class="hero-portfolio-value" id="hero-portfolio-value">$10,000</div>
                    <div class="hero-portfolio-change positive" id="hero-portfolio-change">
                        <span>‚Üó</span>
                        <span id="hero-portfolio-change-text">+$0.00 (0%)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <!-- Header (Compact) - ONLY on Dashboard -->
                <div class="header" style="margin-top: 20px; margin-bottom: 24px; padding: 20px 30px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h1 style="font-size: 1.8em; margin: 0; color: #1A1A1A;">ü§ñ Trading Dashboard</h1>
                            <p style="margin: 5px 0 0 0; font-size: 0.95em; color: #6B7280;">Real-time analysis, predictions, and signals</p>
                        </div>
                        <div class="status-bar" style="margin: 0;">
                            <div class="status-item">
                                <div class="status-indicator"></div>
                                <span>API Connected</span>
                            </div>
                            <div class="status-item">
                                <strong>Status:</strong> <span id="api-status">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2>üè† Dashboard</h2>
                
                <!-- Quick Stats Widget - ONLY on Dashboard -->
                <div class="quick-stats" id="quick-stats" style="margin-bottom: 24px;">
                    <div class="stat-card portfolio">
                        <h3>Portfolio Value</h3>
                        <span class="value" id="stat-portfolio-value">$0.00</span>
                        <span class="change" id="stat-portfolio-change" style="color: #6B7280; font-size: 0.85em;">$0.00 (0%)</span>
                    </div>
                    <div class="stat-card positions">
                        <h3>Active Positions</h3>
                        <span class="value" id="stat-active-positions">0</span>
                    </div>
                    <div class="stat-card pnl">
                        <h3>Today's P&L</h3>
                        <span class="value" id="stat-today-pnl">$0.00</span>
                    </div>
                    <div class="stat-card winrate">
                        <h3>Win Rate</h3>
                        <span class="value" id="stat-win-rate">0%</span>
                    </div>
                    <div class="stat-card status">
                        <h3>Bot Status</h3>
                        <span class="value running" id="stat-bot-status" style="color: #10b981; font-size: 1.5em;">‚óè Running</span>
                    </div>
                </div>
                
                <!-- Auto-Refresh Info - ONLY on Dashboard, more user-friendly -->
                <div style="background: linear-gradient(135deg, #E6F0FF 0%, #F0F9FF 100%); border-left: 4px solid #0066FF; padding: 16px; margin-bottom: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 102, 255, 0.1);">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                        <span style="font-size: 1.5em;">üîÑ</span>
                        <strong style="color: #003D99; font-size: 1.05em;">Auto-Refresh Active</strong>
                    </div>
                    <p style="color: #475569; margin: 0; line-height: 1.6; font-size: 0.95em;">
                        Your dashboard updates automatically every <strong>30 seconds</strong> with the latest data. 
                        Predictions are generated every <strong>5 minutes</strong> by our background service. 
                        <span style="color: #0066FF; font-weight: 600;">No manual refresh needed!</span>
                    </p>
                </div>
                
                <!-- Dashboard content will be loaded by JavaScript -->
                <div id="dashboard-content">
                    <div id="dashboard-stats"></div>
                    <!-- Recent Activity Feed - ONLY in Dashboard -->
                    <div class="activity-feed" style="margin-top: 30px;">
                        <h3>üìä Recent Activity</h3>
                        <ul id="activityList">
                            <li style="text-align: center; color: #6B7280; padding: 20px;">Loading activity...</li>
                        </ul>
                    </div>
                    <div id="trading-settings-preview"></div>
                </div>
            </div>

            <!-- Markets Tab -->
            <div id="markets" class="tab-content">
                <h2 style="color: #1A1A1A; margin-bottom: 24px; font-size: 2em;">üî• Trending Markets</h2>
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); border-left: 4px solid #0066FF; padding: 16px; margin-bottom: 24px; border-radius: 8px; color: #1e40af;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show the latest data. Markets are fetched live from Polymarket API.
                </div>
                
                <!-- Modern Search and Filter Bar -->
                <div class="markets-search-bar">
                    <div class="search-input-wrapper">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="markets-search" class="search-input" placeholder="Search markets by question or category..." onkeyup="filterMarkets()">
                    </div>
                    <select id="markets-outcome" class="search-input" style="min-width: 150px; padding-left: 16px;">
                        <option value="">All Outcomes</option>
                        <option value="YES">YES</option>
                        <option value="NO">NO</option>
                    </select>
                    <label style="display: flex; align-items: center; gap: 10px; color: #475569;">
                        <span>Show:</span>
                        <input type="number" id="markets-limit" value="20" min="10" max="100" step="10" placeholder="20" 
                               title="Controls how many markets appear on the page. Range: 10-100."
                               style="width: 70px; padding: 8px; border: 2px solid #F1F3F5; border-radius: 8px;">
                    </label>
                    <button class="filter-btn" onclick="loadMarkets(true)">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                    <span id="markets-last-updated" style="color: #6B7280; font-size: 0.85em;"></span>
                </div>
                
                <div id="markets-content"></div>
            </div>

            <!-- Predictions Tab -->
            <div id="predictions" class="tab-content">
                <h2>Model Predictions</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show new predictions. Predictions are generated every 5 minutes by the background service.
                </div>
                <div class="controls">
                    <input type="text" id="predictions-market-id" placeholder="Market ID (optional)" style="flex: 1;">
                    <label style="display: flex; align-items: center; gap: 10px; color: #6B7280;">
                        <span>Show:</span>
                        <input type="number" id="predictions-limit" value="50" min="10" max="1000" step="10" placeholder="50" 
                               title="Controls how many predictions appear on the page. Range: 10-1000. Default: 50. Higher = more data but slower loading."
                               style="width: 80px; padding: 8px; border: 1px solid #F8F9FA; border-radius: 4px;">
                        <span><span style="color: #6B7280; font-size: 0.9em;" title="Range: 10-1000 predictions. Default: 50. Hover over the input for details.">(10-1000)</span></span>
                    </label>
                    <button class="btn btn-secondary" onclick="loadPredictions(true)">üîÑ Refresh Now</button>
                    <span id="predictions-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="predictions-content"></div>
            </div>

            <!-- Signals Tab -->
            <div id="signals" class="tab-content">
                <h2>Trading Signals</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show new signals. Signals are created automatically when predictions meet the edge threshold.
                </div>
                <div class="controls">
                    <input type="text" id="signals-market-id" placeholder="Market ID (optional)" style="flex: 1;">
                    <select id="signals-executed">
                        <option value="">All</option>
                        <option value="true">Executed</option>
                        <option value="false">Not Executed</option>
                    </select>
                    <label style="display: flex; align-items: center; gap: 10px; color: #6B7280;">
                        <span>Show:</span>
                        <input type="number" id="signals-limit" value="50" min="10" max="1000" step="10" placeholder="50" 
                               title="Controls how many signals appear on the page. Range: 10-1000. Default: 50. Higher = more data but slower loading."
                               style="width: 80px; padding: 8px; border: 1px solid #F8F9FA; border-radius: 4px;">
                        <span><span style="color: #6B7280; font-size: 0.9em;" title="Range: 10-1000 signals. Default: 50. Hover over the input for details.">(10-1000)</span></span>
                    </label>
                    <button class="btn btn-secondary" onclick="loadSignals(true)">üîÑ Refresh Now</button>
                    <span id="signals-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="signals-content"></div>
            </div>

            <!-- Trades Tab -->
            <div id="trades" class="tab-content">
                <h2>Trades</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show new trades. Trades are created automatically from signals (if auto-trading is enabled).
                </div>
                <div class="controls">
                    <input type="text" id="trades-market-id" placeholder="Market ID (optional)" style="flex: 1;">
                    <select id="trades-status">
                        <option value="">All Status</option>
                        <option value="OPEN">Open</option>
                        <option value="CLOSED">Closed</option>
                        <option value="CANCELLED">Cancelled</option>
                    </select>
                    <label style="display: flex; align-items: center; gap: 10px; color: #6B7280;">
                        <span>Show:</span>
                        <input type="number" id="trades-limit" value="50" min="10" max="1000" step="10" placeholder="50" 
                               title="Controls how many trades appear on the page. Range: 10-1000. Default: 50. Higher = more data but slower loading."
                               style="width: 80px; padding: 8px; border: 1px solid #F8F9FA; border-radius: 4px;">
                        <span><span style="color: #6B7280; font-size: 0.9em;" title="Range: 10-1000 trades. Default: 50. Hover over the input for details.">(10-1000)</span></span>
                    </label>
                    <button class="btn btn-secondary" onclick="loadTrades(true)">üîÑ Refresh Now</button>
                    <span id="trades-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="trades-content"></div>
            </div>

            <!-- Portfolio Tab -->
            <div id="portfolio" class="tab-content">
                <h2>Portfolio</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show portfolio updates. Portfolio is updated automatically when trades are executed.
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="loadPortfolio(true)">üîÑ Refresh Now</button>
                    <span id="portfolio-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="portfolio-content"></div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <h2>üìà Advanced Analytics Dashboard</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds to show the latest analytics. Analytics are calculated from your predictions, signals, and trades.
                </div>
                <div class="controls">
                    <label style="display: flex; align-items: center; gap: 10px; color: #6B7280;">
                        <input type="checkbox" id="analytics-paper-trading" checked> Include Paper Trading
                    </label>
                    <button class="btn btn-secondary" onclick="loadAnalytics(true)">üîÑ Refresh Now</button>
                    <span id="analytics-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="analytics-content"></div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts" class="tab-content">
                <h2>üîî Real-Time Alerts & Notifications</h2>
                <div style="background: #E6F0FF; border-left: 4px solid #10b981; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 30 seconds. Alerts are sent automatically when signals match your configured rules.
                </div>
                <div class="controls">
                    <button class="btn" onclick="showCreateAlertForm()">‚ûï Create New Alert</button>
                    <button class="btn btn-secondary" onclick="loadAlerts(true)">üîÑ Refresh Now</button>
                    <span id="alerts-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em;"></span>
                </div>
                <div id="alerts-content"></div>
            </div>

            <!-- Whale Tracker Tab -->
            <div id="whales" class="tab-content">
                <h2 style="color: #1A1A1A; margin-bottom: 24px; font-size: 2em;">üêã Whale Tracker</h2>
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); border-left: 4px solid #0066FF; padding: 16px; margin-bottom: 24px; border-radius: 8px; color: #1e40af;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every 60 seconds to show the latest whale activity. Monitors top 500 Polymarket traders in real-time.
                </div>
                
                <!-- Tab Buttons -->
                <div style="display: flex; gap: 10px; margin-bottom: 24px;">
                    <button id="whales-tab-leaderboard" onclick="switchWhaleTab('leaderboard')" 
                            style="padding: 12px 24px; background: #0066FF; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Leaderboard
                    </button>
                    <button id="whales-tab-activity" onclick="switchWhaleTab('activity')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Recent Activity
                    </button>
                    <button id="whales-tab-alerts" onclick="switchWhaleTab('alerts')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Alerts
                    </button>
                    <button class="btn btn-secondary" onclick="loadWhales(true)" style="margin-left: auto;">
                        üîÑ Refresh Now
                    </button>
                    <span id="whales-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em; align-self: center;"></span>
                </div>
                
                <!-- Content Areas -->
                <div id="whales-leaderboard-content"></div>
                <div id="whales-activity-content" style="display: none;"></div>
                <div id="whales-alerts-content" style="display: none;"></div>
            </div>

            <!-- Economic Calendar Tab -->
            <div id="calendar" class="tab-content">
                <h2 style="color: #1A1A1A; margin-bottom: 24px; font-size: 2em;">üìÖ Economic Calendar</h2>
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); border-left: 4px solid #0066FF; padding: 16px; margin-bottom: 24px; border-radius: 8px; color: #1e40af;">
                    <strong>‚úÖ Auto-Refresh:</strong> This page automatically refreshes every hour to show upcoming economic events. Track FOMC, CPI, NFP, GDP releases and their impact on markets.
                </div>
                
                <!-- Filter Buttons -->
                <div style="display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap;">
                    <button id="calendar-filter-all" onclick="setCalendarFilter('all')" 
                            style="padding: 12px 24px; background: #0066FF; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        All Events
                    </button>
                    <button id="calendar-filter-fomc" onclick="setCalendarFilter('FOMC')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        FOMC
                    </button>
                    <button id="calendar-filter-cpi" onclick="setCalendarFilter('CPI')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        CPI
                    </button>
                    <button id="calendar-filter-nfp" onclick="setCalendarFilter('NFP')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        NFP
                    </button>
                    <button id="calendar-filter-gdp" onclick="setCalendarFilter('GDP')" 
                            style="padding: 12px 24px; background: #F8F9FA; color: #6B7280; border: 1px solid #F1F3F5; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        GDP
                    </button>
                    <button class="btn btn-secondary" onclick="loadCalendar(true)" style="margin-left: auto;">
                        üîÑ Refresh Now
                    </button>
                    <span id="calendar-last-updated" style="color: #6B7280; margin-left: 15px; font-size: 0.9em; align-self: center;"></span>
                </div>
                
                <!-- Calendar Content -->
                <div id="calendar-content"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>‚öôÔ∏è Settings & Preferences</h2>
                
                <!-- Trading Settings Panel -->
                <div class="settings-panel">
                    <h3>‚öôÔ∏è Auto-Trading Settings</h3>
                    
                    <div class="setting">
                        <label>Minimum Edge (%)</label>
                        <input type="range" min="1" max="20" value="5" id="minEdge" oninput="updateEdgeDisplay(this.value)">
                        <span id="edgeValue">5%</span>
                    </div>
                    
                    <div class="setting">
                        <label>Minimum Confidence (%)</label>
                        <input type="range" min="50" max="90" value="55" id="minConfidence" oninput="updateConfidenceDisplay(this.value)">
                        <span id="confidenceValue">55%</span>
                    </div>
                    
                    <div class="setting">
                        <label>Minimum Liquidity ($)</label>
                        <input type="number" value="500" id="minLiquidity" min="100" step="100">
                        <span>$</span>
                    </div>
                    
                    <div class="setting">
                        <label>Max Position Size ($)</label>
                        <input type="number" value="100" id="maxPosition" min="10" step="10">
                        <span>$</span>
                    </div>
                    
                    <div class="setting">
                        <label>Paper Trading Mode</label>
                        <input type="checkbox" checked id="paperMode">
                        <span id="paperModeStatus">Enabled (Safe for testing)</span>
                    </div>
                    
                    <button class="btn" onclick="saveSettings()" style="width: 100%; margin-top: 20px;">Save Settings</button>
                    <p id="settings-status" style="margin-top: 15px; color: #6B7280;"></p>
                </div>
                
                <!-- Wallet Connection -->
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px;">üîó Wallet Connection</h3>
                    <div id="wallet-info" style="margin-bottom: 20px;">
                        <p id="wallet-status-text" style="color: #6B7280;">Not connected</p>
                    </div>
                    <button class="btn" onclick="connectWallet()" style="background: linear-gradient(135deg, #0066FF 0%, #003D99 100%);">Connect Wallet</button>
                </div>

                <!-- Trading Mode Toggle -->
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #0066FF;">
                    <h3 style="color: #0066FF; margin-bottom: 20px;">üöÄ Trading Mode</h3>
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 15px; cursor: pointer;">
                            <input type="checkbox" id="live-mode" onchange="toggleLiveMode()" style="width: 24px; height: 24px; cursor: pointer;">
                            <div>
                                <strong style="color: #1A1A1A;">Live Mode (Real Trading)</strong>
                                <p style="color: #6B7280; font-size: 0.9em; margin-top: 5px;">When enabled, connects to real MetaMask and processes real deposits/trades. When disabled, uses simulated funds for testing.</p>
                            </div>
                        </label>
                    </div>
                    <div id="mode-status" style="padding: 15px; border-radius: 8px; background: #E6F0FF; color: #f59e0b;">
                        <strong>‚ö†Ô∏è Test Mode Active:</strong> Deposits and trades are simulated. Perfect for testing with $100!
                    </div>
                </div>

                <!-- Account Funding -->
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px;">üí∞ Account Funding</h3>
                    <div id="funding-mode-info" style="margin-bottom: 20px; padding: 15px; background: #E6F0FF; border-left: 4px solid #2196F3; border-radius: 8px;">
                        <p style="margin: 0; color: #0066FF;"><strong>Test Mode:</strong> Simulate deposits to test the system. Start with $100 to see how it works!</p>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Deposit Amount (USD)</label>
                        <input type="number" id="deposit-amount" placeholder="100" min="10" step="10" style="width: 200px; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                    </div>
                    <button class="btn" onclick="depositFunds()" id="deposit-btn" style="background: #10b981;">Deposit Funds (Simulated)</button>
                    <p id="deposit-status" style="margin-top: 15px; color: #6B7280;"></p>
                </div>

                <!-- Trading Preferences -->
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px;">üìä Trading Preferences</h3>
                    
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Trading Mode</label>
                        <select id="trading-mode" style="width: 100%; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                            <option value="auto">Auto-Trade (Recommended)</option>
                            <option value="manual">Manual Review</option>
                        </select>
                        <p style="margin-top: 5px; color: #6B7280; font-size: 0.9em;">Auto-trade executes signals automatically. Manual requires approval for each trade.</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Risk Level</label>
                        <select id="risk-level" style="width: 100%; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                            <option value="conservative">Conservative</option>
                            <option value="moderate" selected>Moderate (Recommended)</option>
                            <option value="aggressive">Aggressive</option>
                        </select>
                        <p style="margin-top: 5px; color: #6B7280; font-size: 0.9em;">Conservative = smaller positions, only STRONG signals. Aggressive = larger positions, all signals.</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Max Position Size (USD)</label>
                        <input type="number" id="max-position" placeholder="200" min="10" step="10" style="width: 100%; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                        <p style="margin-top: 5px; color: #6B7280; font-size: 0.9em;">Maximum amount to bet on a single trade. Recommended: 1-2% of total capital.</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Min Edge Threshold (%)</label>
                        <input type="number" id="min-edge" placeholder="10" min="5" max="30" step="1" style="width: 100%; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                        <p style="margin-top: 5px; color: #6B7280; font-size: 0.9em;">Minimum edge required to create a signal. Higher = fewer but better opportunities.</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; color: #6B7280; font-weight: 600;">Min Confidence (%)</label>
                        <input type="number" id="min-confidence" placeholder="60" min="40" max="90" step="5" style="width: 100%; padding: 10px; border: 1px solid #F8F9FA; border-radius: 4px; font-size: 1em;">
                        <p style="margin-top: 5px; color: #6B7280; font-size: 0.9em;">Minimum confidence level required. Higher = more certain predictions only.</p>
                    </div>

                    <button class="btn" onclick="savePreferences()" style="background: linear-gradient(135deg, #0066FF 0%, #003D99 100%); width: 100%;">Save Preferences</button>
                    <p id="preferences-status" style="margin-top: 15px; color: #6B7280;"></p>
                </div>

                <!-- Account Info -->
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px;">‚ÑπÔ∏è Account Information</h3>
                    <div style="color: #6B7280;">
                        <p><strong>Data Source:</strong> <span id="data-source">Real-time from Polymarket API</span></p>
                        <p style="margin-top: 10px;"><strong>Current Mode:</strong> <span id="current-mode-display">Test Mode (Simulated)</span></p>
                        <div style="margin-top: 15px; padding: 15px; background: #F8F9FA; border-radius: 8px;">
                            <p style="margin-bottom: 10px;"><strong>‚úÖ Real Data:</strong></p>
                            <ul style="margin-left: 20px; color: #6B7280;">
                                <li>Markets from Polymarket API</li>
                                <li>AI predictions from trained models</li>
                                <li>Trading signals based on real edge calculations</li>
                            </ul>
                            <p style="margin-top: 15px; margin-bottom: 10px;"><strong id="simulation-label">‚ö†Ô∏è Simulated (Test Mode):</strong></p>
                            <ul style="margin-left: 20px; color: #6B7280;">
                                <li id="simulation-item-1">Fund deposits (simulated for testing)</li>
                                <li id="simulation-item-2">Trade execution (simulated for testing)</li>
                            </ul>
                            <p style="margin-top: 15px; color: #0066FF;"><strong>üí° Tip:</strong> Use Test Mode to simulate $100 deposits and see how the system works. Enable Live Mode when ready for real trading!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help & FAQ Tab -->
            <div id="help" class="tab-content">
                <h2>‚ùì Help & FAQ</h2>
                <p style="color: #6B7280; margin-bottom: 30px;">Complete guide to understanding and using the Polymarket AI Trading Bot</p>
                
                <!-- Quick Navigation -->
                <div style="background: #FFFFFF; padding: 20px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 15px;">üìë Quick Navigation</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <a href="#getting-started" style="padding: 10px 20px; background: #F8F9FA; border-radius: 8px; text-decoration: none; color: #0066FF; font-weight: 600;">Getting Started</a>
                        <a href="#page-guide" style="padding: 10px 20px; background: #F8F9FA; border-radius: 8px; text-decoration: none; color: #0066FF; font-weight: 600;">Page Guide</a>
                        <a href="#key-concepts" style="padding: 10px 20px; background: #F8F9FA; border-radius: 8px; text-decoration: none; color: #0066FF; font-weight: 600;">Key Concepts</a>
                        <a href="#faq" style="padding: 10px 20px; background: #F8F9FA; border-radius: 8px; text-decoration: none; color: #0066FF; font-weight: 600;">FAQ</a>
                        <a href="#troubleshooting" style="padding: 10px 20px; background: #F8F9FA; border-radius: 8px; text-decoration: none; color: #0066FF; font-weight: 600;">Troubleshooting</a>
                    </div>
                </div>

                <!-- Getting Started -->
                <div id="getting-started" style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px; font-size: 1.8em;">üöÄ Getting Started</h3>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Step 1: Connect Your Wallet</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">On the landing page or Settings tab, click "Connect Wallet" and approve the connection in MetaMask.</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>Your wallet address will be displayed</li>
                            <li>No funds are transferred during connection</li>
                            <li>You can disconnect anytime</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Step 2: Choose Your Mode</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">Go to Settings tab and choose:</p>
                        <div style="background: #E6F0FF; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ffc107;">
                            <strong>Test Mode (Recommended for First Time):</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li>Simulate deposits (test with $100)</li>
                                <li>See how predictions and signals work</li>
                                <li>No real money at risk</li>
                            </ul>
                        </div>
                        <div style="background: #E6F0FF; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                            <strong>Live Mode (When Ready):</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li>Real MetaMask deposits</li>
                                <li>Real Polymarket trades</li>
                                <li>Real funds, real trading</li>
                            </ul>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Step 3: Fund Your Account</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">In Settings tab, enter deposit amount and click "Deposit Funds":</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>Test Mode:</strong> Simulated deposit (instant, no real transfer)</li>
                            <li><strong>Live Mode:</strong> Real MetaMask transaction (confirm in wallet)</li>
                            <li>Start with $100 to test the system</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Step 4: Set Your Preferences</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">Configure your trading settings in Settings tab:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>Trading Mode:</strong> Auto-trade (recommended) or Manual review</li>
                            <li><strong>Risk Level:</strong> Conservative, Moderate, or Aggressive</li>
                            <li><strong>Max Position Size:</strong> Maximum $ per trade (recommend 1-2% of capital)</li>
                            <li><strong>Min Edge:</strong> Minimum opportunity % (default: 10%)</li>
                            <li><strong>Min Confidence:</strong> Minimum certainty % (default: 60%)</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-top: 10px;">Click "Save Preferences" when done.</p>
                    </div>

                    <div>
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Step 5: Monitor Your Dashboard</h4>
                        <p style="color: #6B7280; line-height: 1.8;">The system runs automatically. Check these tabs regularly:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>Predictions:</strong> See AI model predictions</li>
                            <li><strong>Signals:</strong> View trading opportunities</li>
                            <li><strong>Trades:</strong> Monitor your positions</li>
                            <li><strong>Portfolio:</strong> Track performance</li>
                        </ul>
                    </div>
                </div>

                <!-- Page Guide -->
                <div id="page-guide" style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px; font-size: 1.8em;">üìä Page-by-Page Guide</h3>
                    
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">üìä Markets Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> All available prediction markets from Polymarket</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>How to use:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li>Data loads automatically when you open the tab</li>
                            <li>Data refreshes every 30 seconds automatically</li>
                            <li>Browse markets to find interesting questions</li>
                            <li>Use "Refresh Now" button for manual refresh if needed</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Display Limit:</strong> <span style="background: #E6F0FF; padding: 4px 8px; border-radius: 4px; font-weight: 600;">10-100 markets</span> (Default: 50) - Controls how many markets appear on the page. Higher = more data but slower loading.</p>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>Key fields:</strong> Question, YES/NO prices, Outcome (Active/Resolved/Closed), Resolution Date</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">üîÆ Predictions Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> AI model predictions for markets</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>How to use:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li>Data loads automatically when you open the tab</li>
                            <li>Data refreshes every 30 seconds automatically</li>
                            <li>Look for predictions with <strong>high edge</strong> (>10%) = opportunity</li>
                            <li>Look for predictions with <strong>high confidence</strong> (>60%) = model is sure</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Display Limit:</strong> <span style="background: #E6F0FF; padding: 4px 8px; border-radius: 4px; font-weight: 600;">10-1000 predictions</span> (Default: 50) - Controls how many predictions appear on the page. Higher = more data but slower loading.</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Understanding the data:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li><strong>Model Probability:</strong> What the AI thinks (0-100%)</li>
                            <li><strong>Market Price:</strong> Current market price</li>
                            <li><strong>Edge:</strong> Difference (positive = opportunity)</li>
                            <li><strong>Confidence:</strong> How sure the model is</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>What happens next:</strong> Predictions with edge >5% automatically generate signals</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">üì° Signals Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> Trading signals generated from predictions</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>How to use:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li>Data loads automatically when you open the tab</li>
                            <li>Data refreshes every 30 seconds automatically</li>
                            <li>Focus on <strong>STRONG signals</strong> (best opportunities)</li>
                            <li>Signals are automatically created from predictions</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Display Limit:</strong> <span style="background: #E6F0FF; padding: 4px 8px; border-radius: 4px; font-weight: 600;">10-1000 signals</span> (Default: 50) - Controls how many signals appear on the page. Higher = more data but slower loading.</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Signal Strength:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li><strong>STRONG:</strong> >15% edge (best opportunities)</li>
                            <li><strong>MEDIUM:</strong> 10-15% edge (good opportunities)</li>
                            <li><strong>WEAK:</strong> 5-10% edge (small opportunities)</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>What happens next:</strong> Signals automatically become trades if auto-trading is enabled</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">üíº Trades Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> All executed trades</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>How to use:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li>Data loads automatically when you open the tab</li>
                            <li>Data refreshes every 30 seconds automatically</li>
                            <li>Monitor <strong>OPEN trades</strong> for active positions</li>
                            <li>Review <strong>P&L</strong> on closed trades</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Display Limit:</strong> <span style="background: #E6F0FF; padding: 4px 8px; border-radius: 4px; font-weight: 600;">10-1000 trades</span> (Default: 50) - Controls how many trades appear on the page. Higher = more data but slower loading.</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Understanding the data:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li><strong>Side:</strong> YES or NO position</li>
                            <li><strong>Entry Price:</strong> Price when trade opened</li>
                            <li><strong>Size:</strong> Position size in USD</li>
                            <li><strong>Status:</strong> OPEN, CLOSED, or CANCELLED</li>
                            <li><strong>P&L:</strong> Profit/Loss (shown when closed)</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">üí∞ Portfolio Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> Overall portfolio performance</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>How to use:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li>Data loads automatically when you open the tab</li>
                            <li>Data refreshes every 30 seconds automatically</li>
                            <li>Monitor your portfolio performance in real-time</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Display Limit:</strong> <span style="background: #E6F0FF; padding: 4px 8px; border-radius: 4px; font-weight: 600;">Shows latest snapshot</span> - Portfolio displays the most recent snapshot automatically.</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Key Metrics:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 10px;">
                            <li><strong>Total Value:</strong> Entire portfolio (cash + positions + P&L)</li>
                            <li><strong>Cash:</strong> Money available for new trades</li>
                            <li><strong>Positions Value:</strong> Current value of open positions</li>
                            <li><strong>Total Exposure:</strong> Amount at risk</li>
                            <li><strong>Daily P&L:</strong> Profit/Loss today</li>
                            <li><strong>Unrealized P&L:</strong> Profit/Loss on open positions</li>
                            <li><strong>Realized P&L:</strong> Profit/Loss on closed trades</li>
                        </ul>
                    </div>

                    <div>
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.3em;">‚öôÔ∏è Settings Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>What it shows:</strong> Account configuration and preferences</p>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Sections:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>Wallet Connection:</strong> Connect/disconnect MetaMask</li>
                            <li><strong>Trading Mode:</strong> Toggle between Test Mode and Live Mode</li>
                            <li><strong>Account Funding:</strong> Deposit funds (simulated or real)</li>
                            <li><strong>Trading Preferences:</strong> Configure risk, position sizes, thresholds</li>
                            <li><strong>Account Information:</strong> View data source and mode status</li>
                        </ul>
                    </div>
                </div>

                <!-- Key Concepts -->
                <div id="key-concepts" style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px; font-size: 1.8em;">üéØ Key Concepts</h3>
                    
                    <div style="margin-bottom: 25px; padding: 20px; background: #F8F9FA; border-left: 4px solid #0066FF; border-radius: 8px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 15px; font-size: 1.2em;">üìä Display Limits by Tab</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 15px;">Each tab has a limit control that determines how many items appear on the page. This helps balance performance with visibility.</p>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <thead>
                                <tr style="background: #0066FF; color: white;">
                                    <th style="padding: 12px; text-align: left; border: 1px solid #F8F9FA;">Tab</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #F8F9FA;">Range</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #F8F9FA;">Default</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #F8F9FA;">Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border: 1px solid #F8F9FA;">
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;"><strong>Markets</strong></td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">10-100</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">50</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Limited by live API</td>
                                </tr>
                                <tr style="border: 1px solid #F8F9FA; background: #F8F9FA;">
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;"><strong>Predictions</strong></td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">10-1000</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">50</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Database limit</td>
                                </tr>
                                <tr style="border: 1px solid #F8F9FA;">
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;"><strong>Signals</strong></td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">10-1000</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">50</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Database limit</td>
                                </tr>
                                <tr style="border: 1px solid #F8F9FA; background: #F8F9FA;">
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;"><strong>Trades</strong></td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">10-1000</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">50</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Database limit</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;"><strong>Portfolio</strong></td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Latest only</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">N/A</td>
                                    <td style="padding: 12px; border: 1px solid #F8F9FA;">Shows most recent snapshot</td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="color: #6B7280; line-height: 1.8; margin-top: 15px; font-size: 0.9em;"><strong>üí° Tip:</strong> Hover over the limit input on any tab to see a tooltip explaining the range. Higher limits show more data but may load slower.</p>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">What is "Edge"?</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">Edge is the difference between what the AI thinks and what the market thinks:</p>
                        <div style="background: #F8F9FA; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <p style="margin: 0;"><strong>Example:</strong></p>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li>Market says: 40% chance</li>
                                <li>AI Model says: 70% chance</li>
                                <li><strong>Edge: +30%</strong> (big opportunity!)</li>
                            </ul>
                        </div>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>Positive edge:</strong> AI thinks market is undervalued (opportunity)</li>
                            <li><strong>Negative edge:</strong> AI thinks market is overvalued</li>
                            <li><strong>Higher edge = Better opportunity</strong></li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">What is "Confidence"?</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">Confidence is how sure the AI model is in its prediction:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>High confidence</strong> (>60%): Model is very sure</li>
                            <li><strong>Low confidence</strong> (<40%): Model is uncertain</li>
                            <li><strong>Use with edge:</strong> High edge + high confidence = best trades</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Signal Strength</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;">Signals are categorized by edge size:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li><strong>STRONG:</strong> >15% edge (best opportunities, consider trading)</li>
                            <li><strong>MEDIUM:</strong> 10-15% edge (good opportunities, review carefully)</li>
                            <li><strong>WEAK:</strong> 5-10% edge (small edge, may not be worth it)</li>
                        </ul>
                    </div>

                    <div>
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.3em;">Test Mode vs Live Mode</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Test Mode (Default):</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                            <li>‚úÖ Real market data and predictions</li>
                            <li>‚ö†Ô∏è Simulated deposits (test with $100)</li>
                            <li>‚ö†Ô∏è Simulated trade execution</li>
                            <li>Perfect for learning and testing</li>
                        </ul>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Live Mode:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>‚úÖ Real market data and predictions</li>
                            <li>‚úÖ Real MetaMask deposits</li>
                            <li>‚úÖ Real Polymarket trades</li>
                            <li>Real funds, real trading</li>
                        </ul>
                    </div>
                </div>

                <!-- FAQ -->
                <div id="faq" style="background: #FFFFFF; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px; font-size: 1.8em;">‚ùì Frequently Asked Questions</h3>
                    
                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: Is the data real or simulated?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> All market data, predictions, and signals are <strong>100% real</strong> from Polymarket API and trained AI models. Only deposits and trades are simulated in Test Mode. In Live Mode, everything is real.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: How do I test with $100?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> Go to Settings tab, make sure Test Mode is active (Live Mode OFF), enter $100 in deposit field, click "Deposit Funds (Simulated)". The system will simulate the deposit and you can test all features without risking real money.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: When should I switch to Live Mode?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> Switch to Live Mode when you're comfortable with how the system works and ready to trade with real funds. Make sure you understand the risks and have tested thoroughly in Test Mode first.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: How often does the system analyze markets?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> The system runs automatically in the background, typically analyzing markets every hour or daily (configurable). You don't need to do anything - it works 24/7.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: What's the difference between predictions and signals?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> <strong>Predictions</strong> are AI model probability estimates for each market. <strong>Signals</strong> are trading recommendations created from predictions that have significant edge (>5%). Signals tell you when and what to trade.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: How do trades get created?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> If auto-trading is enabled, trades are automatically created from signals. If manual review is enabled, you review signals in the Signals tab and execute them manually.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: What if I don't see any data?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> Data loads automatically when you open each tab. If you don't see data:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-top: 10px;">
                            <li>Make sure you've connected your wallet and funded your account</li>
                            <li>Wait a few minutes for the system to analyze markets</li>
                            <li>Data refreshes automatically every 30 seconds</li>
                            <li>Use "Refresh Now" button if you want to manually refresh</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: Can I change my preferences later?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> Yes! Go to Settings tab anytime, adjust your preferences, and click "Save Preferences". Changes take effect immediately for new signals and trades.</p>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #eee;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: Is my money safe?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> In Test Mode, no real money is involved. In Live Mode, your funds are held in your MetaMask wallet or the trading account. Always start with small amounts and never invest more than you can afford to lose. Trading involves risk.</p>
                    </div>

                    <div>
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Q: How do I know if the system is working?</h4>
                        <p style="color: #6B7280; line-height: 1.8;"><strong>A:</strong> Check these indicators:</p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px; margin-top: 10px;">
                            <li>Predictions tab shows predictions with edges</li>
                            <li>Signals tab shows signals (if edge > threshold)</li>
                            <li>Trades tab shows trades (if auto-trading enabled)</li>
                            <li>Portfolio tab shows portfolio value</li>
                        </ul>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <div id="troubleshooting" style="background: #FFFFFF; padding: 30px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 style="color: #0066FF; margin-bottom: 20px; font-size: 1.8em;">üîß Troubleshooting</h3>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Problem: Can't connect wallet</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Solutions:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>Make sure MetaMask is installed in your browser</li>
                            <li>Refresh the page and try again</li>
                            <li>Check that MetaMask is unlocked</li>
                            <li>Try a different browser if issues persist</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Problem: No data showing in tabs</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Solutions:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>Data loads automatically - just wait a moment when opening a tab</li>
                            <li>Wait a few minutes for system to analyze markets</li>
                            <li>Make sure you've funded your account (even simulated)</li>
                            <li>Data refreshes automatically every 30 seconds</li>
                            <li>Use "Refresh Now" button for manual refresh</li>
                            <li>Check that the API server is running</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Problem: No signals being generated</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Solutions:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>Check your Min Edge Threshold in Settings (lower it if too high)</li>
                            <li>Check your Min Confidence in Settings (lower it if too high)</li>
                            <li>Wait for more markets to be analyzed</li>
                            <li>Check Predictions tab to see if predictions have edge</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Problem: Deposit not working</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Solutions:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>In Test Mode: Should work instantly (simulated)</li>
                            <li>In Live Mode: Check MetaMask popup and confirm transaction</li>
                            <li>Make sure wallet is connected</li>
                            <li>Check that you have sufficient funds in wallet (Live Mode)</li>
                        </ul>
                    </div>

                    <div>
                        <h4 style="color: #1A1A1A; margin-bottom: 10px; font-size: 1.2em;">Problem: Trades not executing</h4>
                        <p style="color: #6B7280; line-height: 1.8; margin-bottom: 10px;"><strong>Solutions:</strong></p>
                        <ul style="color: #6B7280; line-height: 1.8; margin-left: 20px;">
                            <li>Check that auto-trading is enabled in Settings</li>
                            <li>Make sure you have sufficient funds in account</li>
                            <li>Check that signals are being generated</li>
                            <li>In Live Mode: Check MetaMask for transaction confirmations</li>
                        </ul>
                    </div>
                </div>

                <!-- Contact/Support -->
                <div style="background: linear-gradient(135deg, #0066FF 0%, #003D99 100%); padding: 30px; border-radius: 12px; color: white; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.8em;">üí¨ Need More Help?</h3>
                    <p style="margin-bottom: 20px; opacity: 0.95;">If you can't find the answer you're looking for, check the documentation or contact support.</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <a href="/static/index.html" style="padding: 12px 24px; background: #FFFFFF; color: #0066FF; border-radius: 8px; text-decoration: none; font-weight: 600;">Back to Dashboard</a>
                        <a href="#getting-started" style="padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">Start Over</a>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        // Auto-detect API base URL (works for localhost and Railway)
        const API_BASE = window.location.origin;

        // ============================================================================
        // PERFORMANCE OPTIMIZATION: API Caching Layer
        // ============================================================================
        const DataCache = {
            cache: new Map(),
            activeRequests: new Map(),
            
            // Cache durations (in milliseconds)
            CACHE_DURATIONS: {
                markets: 30 * 1000,        // 30 seconds
                predictions: 60 * 1000,     // 1 minute
                signals: 60 * 1000,         // 1 minute
                trades: 60 * 1000,          // 1 minute
                portfolio: 5 * 60 * 1000,   // 5 minutes
                dashboard: 30 * 1000,       // 30 seconds
                health: 10 * 1000,          // 10 seconds
                default: 30 * 1000          // 30 seconds default
            },
            
            getCacheKey(endpoint, params = {}) {
                // Create cache key from endpoint and params
                const paramsStr = JSON.stringify(params);
                return `${endpoint}:${paramsStr}`;
            },
            
            getCacheDuration(endpoint) {
                // Determine cache duration based on endpoint
                if (endpoint.includes('markets')) return this.CACHE_DURATIONS.markets;
                if (endpoint.includes('predictions')) return this.CACHE_DURATIONS.predictions;
                if (endpoint.includes('signals')) return this.CACHE_DURATIONS.signals;
                if (endpoint.includes('trades')) return this.CACHE_DURATIONS.trades;
                if (endpoint.includes('portfolio')) return this.CACHE_DURATIONS.portfolio;
                if (endpoint.includes('dashboard')) return this.CACHE_DURATIONS.dashboard;
                if (endpoint.includes('health')) return this.CACHE_DURATIONS.health;
                return this.CACHE_DURATIONS.default;
            },
            
            get(cacheKey) {
                const entry = this.cache.get(cacheKey);
                if (!entry) return null;
                
                // Check if expired
                if (Date.now() > entry.expiresAt) {
                    this.cache.delete(cacheKey);
                    return null;
                }
                
                return entry.data;
            },
            
            set(cacheKey, data, duration) {
                const now = Date.now();
                this.cache.set(cacheKey, {
                    data,
                    timestamp: now,
                    expiresAt: now + (duration || this.CACHE_DURATIONS.default)
                });
            },
            
            invalidate(pattern) {
                // Invalidate all keys matching pattern
                for (const key of this.cache.keys()) {
                    if (key.includes(pattern)) {
                        this.cache.delete(key);
                    }
                }
            },
            
            clear() {
                this.cache.clear();
            }
        };
        
        // Optimized fetch with caching and request deduplication
        async function cachedFetch(endpoint, options = {}, params = {}) {
            const cacheKey = DataCache.getCacheKey(endpoint, params);
            const duration = DataCache.getCacheDuration(endpoint);
            const forceRefresh = options.forceRefresh || false;
            
            // Check cache first (unless force refresh)
            if (!forceRefresh) {
                const cached = DataCache.get(cacheKey);
                if (cached) {
                    console.log(`‚úÖ Cache hit: ${endpoint}`);
                    return cached;
                }
            }
            
            // Deduplicate identical requests
            if (DataCache.activeRequests.has(cacheKey)) {
                console.log(`üîÑ Deduping request: ${endpoint}`);
                return DataCache.activeRequests.get(cacheKey);
            }
            
            // Make request
            const requestPromise = fetch(`${API_BASE}${endpoint}`, options)
                .then(async response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    
                    // Cache successful responses
                    DataCache.set(cacheKey, data, duration);
                    
                    return data;
                })
                .finally(() => {
                    // Remove from active requests
                    DataCache.activeRequests.delete(cacheKey);
                });
            
            // Track active request
            DataCache.activeRequests.set(cacheKey, requestPromise);
            
            return requestPromise;
        }
        
        // Parallel fetch helper
        async function parallelFetch(requests) {
            return Promise.all(requests);
        }

        // Check API health on load (cached)
        async function checkHealth() {
            try {
                const data = await cachedFetch('/health');
                document.getElementById('api-status').textContent = data.status;
                document.getElementById('api-version').textContent = data.version;
            } catch (error) {
                document.getElementById('api-status').textContent = 'Disconnected';
                document.getElementById('api-status').style.color = '#ef4444';
            }
        }

        // Tab switching with auto-load
        // Sidebar toggle functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        function closeSidebar() {
            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.remove('open');
            }
        }

        function showTab(tabName) {
            // Remove active from all nav items and content
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Set active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`showTab('${tabName}')`)) {
                    item.classList.add('active');
                }
            });
            
            // Show/hide hero section - ONLY on Dashboard
            const heroSection = document.getElementById('hero-section');
            if (heroSection) {
                if (tabName === 'dashboard') {
                    heroSection.style.display = 'block';
                } else {
                    heroSection.style.display = 'none';
                }
            }
            
            // Set active content (with null check)
            const contentElement = document.getElementById(tabName);
            if (!contentElement) {
                console.error(`Tab content element not found: ${tabName}`);
                return;
            }
            contentElement.classList.add('active');
            
            // Auto-load data when tab is switched
            switch(tabName) {
                case 'dashboard':
                    // OPTIMIZED: Load dashboard data in parallel
                    parallelFetch([
                        loadDashboardStats(),
                        loadActivity()
                    ]).catch(err => console.error('Dashboard load error:', err));
                    break;
                case 'markets':
                    loadMarkets();
                    break;
                case 'predictions':
                    loadPredictions();
                    break;
                case 'signals':
                    loadSignals();
                    break;
                case 'trades':
                    loadTrades();
                    break;
                case 'portfolio':
                    loadPortfolio();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'alerts':
                    loadAlerts();
                    break;
                case 'whales':
                    loadWhales();
                    break;
                case 'calendar':
                    // loadCalendar is async, but we don't need to await it
                    loadCalendar().catch(err => console.error('Calendar load error:', err));
                    break;
            }
        }

        // Loading state
        function showLoading(containerId) {
            document.getElementById(containerId).innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading data...</p>
                </div>
            `;
        }

        // Error state
        function showError(containerId, message) {
            document.getElementById(containerId).innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }
        
        // Update last updated timestamp (in Central Time)
        function updateLastUpdated(tabName) {
            const now = new Date();
            // Format in Central Time
            const options = {
                timeZone: 'America/Chicago',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const timeString = now.toLocaleTimeString('en-US', options) + ' CT';
            const element = document.getElementById(`${tabName}-last-updated`);
            if (element) {
                element.textContent = `Last updated: ${timeString}`;
            }
        }

        // Load Markets - OPTIMIZED with caching and parallel fetching
        async function loadMarkets(refresh = false) {
            const container = document.getElementById('markets-content');
            if (!refresh) showLoading('markets-content');

            try {
                // OPTIMIZED: Reduce default limit from 50 to 20 for faster loads
                const limit = document.getElementById('markets-limit').value || 20;
                const outcome = document.getElementById('markets-outcome').value;
                
                // OPTIMIZED: Try live and DB in parallel, then use best result
                const params = { limit, outcome };
                let markets = [];
                
                try {
                    // Parallel fetch: try both live and DB simultaneously
                    const [liveResult, dbResult] = await parallelFetch([
                        cachedFetch(`/live/markets?limit=${limit}`, {}, params).catch(() => []),
                        (async () => {
                            let url = `/markets?limit=${limit}`;
                            if (outcome) url += `&outcome=${outcome}`;
                            return cachedFetch(url, {}, params).catch(() => []);
                        })()
                    ]);
                    
                    // Use live data if available, otherwise use DB
                    markets = (liveResult && liveResult.length > 0) ? liveResult : (dbResult || []);
                } catch (e) {
                    console.warn('Market fetch error:', e);
                }
                
                if (markets.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No markets found. The system will automatically fetch markets when available.</p></div>';
                    return;
                }
                
                displayMarkets(markets, container, markets.length > 0);
                updateLastUpdated('markets');
            } catch (error) {
                showError('markets-content', error.message);
            }
        }

        // Display markets (shared function) - Modern Card Layout
        function displayMarkets(markets, container, isLive = false) {
            if (markets.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No markets found. The system will automatically fetch markets when available.</p></div>';
                return;
            }

            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding: 16px 20px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.1em; font-weight: 700; color: #1A1A1A;">
                        üìä ${markets.length} ${markets.length === 1 ? 'Market' : 'Markets'} Found
                    </div>
                    ${isLive ? '<div style="padding: 8px 16px; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 8px; font-weight: 600; font-size: 0.9em;">‚ö° Live Data</div>' : ''}
                </div>
                <div class="markets-grid" id="markets-grid">
            `;

            markets.forEach(market => {
                // Calculate probability from YES price
                const yesPrice = market.yes_price !== undefined ? market.yes_price : (market.yesPrice || 0.5);
                const probability = yesPrice * 100;
                
                // Format question
                const question = market.question || (market.market_id ? `${market.market_id.substring(0, 50)}...` : 'N/A');
                
                // Format category
                const category = market.category || 'Uncategorized';
                
                // Format resolution date
                const resolutionDate = market.resolution_date || market.resolutionDate;
                const endDateStr = resolutionDate ? new Date(resolutionDate).toLocaleDateString() : 'Ongoing';
                
                // Format volume
                const volume = market.volume_24h || market.volume24h || 0;
                const volumeStr = volume > 0 ? `$${(volume / 1000).toFixed(0)}K` : 'N/A';
                
                html += `
                    <div class="market-card" data-market-id="${market.market_id || market.id}" data-question="${question.toLowerCase()}" data-category="${category.toLowerCase()}">
                        <div class="market-card-header">
                            <span class="market-category">${category}</span>
                            ${market.outcome ? `<span class="badge ${market.outcome === 'YES' ? 'badge-success' : 'badge-danger'}" style="background: ${market.outcome === 'YES' ? '#d1fae5' : '#fee2e2'}; color: ${market.outcome === 'YES' ? '#065f46' : '#991b1b'};">${market.outcome}</span>` : '<span class="badge badge-info" style="background: #dbeafe; color: #1e40af;">Active</span>'}
                        </div>
                        <div class="market-question">${question}</div>
                        <div class="market-probability">
                            <div class="market-probability-header">
                                <span class="market-probability-label">YES Probability</span>
                                <span class="market-probability-value">${probability.toFixed(1)}%</span>
                            </div>
                            <div class="market-probability-bar">
                                <div class="market-probability-fill" style="width: ${probability}%;"></div>
                            </div>
                        </div>
                        <div class="market-stats">
                            <div>
                                <strong>Volume:</strong> ${volumeStr}
                            </div>
                            <div>
                                <strong>Ends:</strong> ${endDateStr}
                            </div>
                        </div>
                        <button class="market-action-btn" onclick="viewMarketDetails('${market.market_id || market.id}')">
                            View Details ‚Üí
                        </button>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Filter markets by search query
        function filterMarkets() {
            const searchQuery = document.getElementById('markets-search').value.toLowerCase();
            const outcomeFilter = document.getElementById('markets-outcome').value;
            const cards = document.querySelectorAll('.market-card');
            
            cards.forEach(card => {
                const question = card.getAttribute('data-question') || '';
                const category = card.getAttribute('data-category') || '';
                const outcomeBadge = card.querySelector('.badge');
                const outcome = outcomeBadge ? outcomeBadge.textContent.trim() : '';
                
                const matchesSearch = !searchQuery || question.includes(searchQuery) || category.includes(searchQuery);
                const matchesOutcome = !outcomeFilter || outcome === outcomeFilter;
                
                if (matchesSearch && matchesOutcome) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // View market details (placeholder)
        function viewMarketDetails(marketId) {
            // Navigate to predictions tab and filter by market ID
            showTab('predictions');
            document.getElementById('predictions-market-id').value = marketId;
            loadPredictions(true);
        }

        // Update outcome filter to also filter cards
        document.addEventListener('DOMContentLoaded', function() {
            const outcomeSelect = document.getElementById('markets-outcome');
            if (outcomeSelect) {
                outcomeSelect.addEventListener('change', filterMarkets);
            }
        });

        // Load Predictions - OPTIMIZED with caching
        async function loadPredictions(refresh = false) {
            const container = document.getElementById('predictions-content');
            if (!refresh) showLoading('predictions-content');

            try {
                // OPTIMIZED: Reduce default limit from 50 to 20
                const limit = document.getElementById('predictions-limit').value || 20;
                const marketId = document.getElementById('predictions-market-id').value;
                let url = `/predictions?limit=${limit}`;
                if (marketId) url += `&market_id=${marketId}`;

                const params = { limit, market_id: marketId };
                const predictions = await cachedFetch(url, { forceRefresh: refresh }, params);
                
                if (predictions.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No predictions found yet. The system automatically generates predictions - check back soon!</p></div>';
                    return;
                }

                displayPredictions(predictions, container);
                updateLastUpdated('predictions');
            } catch (error) {
                showError('predictions-content', error.message);
            }
        }


        // Display predictions (shared function)
        function displayPredictions(predictions, container, isDemo = false) {
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Predictions</h3>
                        <div class="value">${predictions.length}</div>
                    </div>
                    ${isDemo ? '<div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #20c997 100%);"><h3>Data Source</h3><div class="value" style="font-size: 1.2em;">Demo</div></div>' : ''}
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Model Prob</th>
                                <th>Market Price</th>
                                <th>Edge</th>
                                <th>Confidence</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            predictions.forEach(p => {
                const edgeClass = p.edge > 0 ? 'badge-success' : 'badge-danger';
                const question = p.question || (p.market_id ? `${p.market_id.substring(0, 30)}...` : 'N/A');
                html += `
                    <tr>
                        <td><strong>${question}</strong></td>
                        <td><strong>${(p.model_probability * 100).toFixed(2)}%</strong></td>
                        <td>${(p.market_price * 100).toFixed(2)}%</td>
                        <td><span class="badge ${edgeClass}">${(p.edge * 100).toFixed(2)}%</span></td>
                        <td>${(p.confidence * 100).toFixed(2)}%</td>
                        <td>${new Date(p.prediction_time).toLocaleString()}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Load Signals - OPTIMIZED with caching
        async function loadSignals(refresh = false) {
            const container = document.getElementById('signals-content');
            if (!refresh) showLoading('signals-content');

            try {
                // OPTIMIZED: Reduce default limit from 50 to 20
                const limit = document.getElementById('signals-limit').value || 20;
                const marketId = document.getElementById('signals-market-id').value;
                const executed = document.getElementById('signals-executed').value;
                let url = `/signals?limit=${limit}`;
                if (marketId) url += `&market_id=${marketId}`;
                if (executed) url += `&executed=${executed}`;

                const params = { limit, market_id: marketId, executed };
                const signals = await cachedFetch(url, { forceRefresh: refresh }, params);
                
                if (signals.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No signals found yet. Signals are automatically created from predictions - check back soon!</p></div>';
                    return;
                }

                displaySignals(signals, container);
                updateLastUpdated('signals');
            } catch (error) {
                showError('signals-content', error.message);
            }
        }


        // Display signals (shared function)
        function displaySignals(signals, container, isDemo = false) {
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Signals</h3>
                        <div class="value">${signals.length}</div>
                    </div>
                    ${isDemo ? '<div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #20c997 100%);"><h3>Data Source</h3><div class="value" style="font-size: 1.2em;">Demo</div></div>' : ''}
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Side</th>
                                <th>Strength</th>
                                <th>Edge</th>
                                <th>Size</th>
                                <th>Executed</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            signals.forEach(s => {
                const sideBadge = s.side === 'YES' ? 'badge-success' : 'badge-danger';
                const strengthBadge = s.signal_strength === 'STRONG' ? 'badge-success' : 
                                     s.signal_strength === 'MEDIUM' ? 'badge-warning' : 'badge-info';
                const question = s.question || (s.market_id ? `${s.market_id.substring(0, 40)}...` : 'N/A');
                html += `
                    <tr>
                        <td><strong>${question}</strong></td>
                        <td><span class="badge ${sideBadge}">${s.side}</span></td>
                        <td><span class="badge ${strengthBadge}">${s.signal_strength}</span></td>
                        <td>${s.edge != null && !isNaN(s.edge) ? (s.edge * 100).toFixed(2) + '%' : '-'}</td>
                        <td>${s.suggested_size ? `$${s.suggested_size.toFixed(2)}` : '-'}</td>
                        <td>${s.executed ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
                        <td>${new Date(s.created_at).toLocaleString()}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Load Trades - OPTIMIZED with caching
        async function loadTrades(refresh = false) {
            const container = document.getElementById('trades-content');
            if (!refresh) showLoading('trades-content');

            try {
                // OPTIMIZED: Reduce default limit from 50 to 20
                const limit = document.getElementById('trades-limit').value || 20;
                const marketId = document.getElementById('trades-market-id').value;
                const status = document.getElementById('trades-status').value;
                let url = `/trades?limit=${limit}`;
                if (marketId) url += `&market_id=${marketId}`;
                if (status) url += `&status=${status}`;

                const params = { limit, market_id: marketId, status };
                const trades = await cachedFetch(url, { forceRefresh: refresh }, params);
                
                if (trades.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No trades found yet. Trades are automatically created from signals - check back soon!</p></div>';
                    return;
                }

                displayTrades(trades, container);
                updateLastUpdated('trades');
            } catch (error) {
                showError('trades-content', error.message);
            }
        }


        // Display trades (shared function)
        function displayTrades(trades, container, isDemo = false) {
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Trades</h3>
                        <div class="value">${trades.length}</div>
                    </div>
                    ${isDemo ? '<div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #20c997 100%);"><h3>Data Source</h3><div class="value" style="font-size: 1.2em;">Demo</div></div>' : ''}
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Side</th>
                                <th>Entry Price</th>
                                <th>Exit Price</th>
                                <th>Size</th>
                                <th>P&L</th>
                                <th>Status</th>
                                <th>Entry Time</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            trades.forEach(t => {
                const pnlBadge = t.pnl && t.pnl > 0 ? 'badge-success' : t.pnl && t.pnl < 0 ? 'badge-danger' : '';
                const statusBadge = t.status === 'CLOSED' ? 'badge-success' : 
                                   t.status === 'OPEN' ? 'badge-info' : 'badge-warning';
                const question = t.question || (t.market_id ? `${t.market_id.substring(0, 40)}...` : 'N/A');
                html += `
                    <tr>
                        <td><strong>${question}</strong></td>
                        <td><span class="badge ${t.side === 'YES' ? 'badge-success' : 'badge-danger'}">${t.side}</span></td>
                        <td>${(t.entry_price * 100).toFixed(2)}%</td>
                        <td>${t.exit_price ? (t.exit_price * 100).toFixed(2) + '%' : '-'}</td>
                        <td>$${t.size.toFixed(2)}</td>
                        <td>${t.pnl ? `<span class="badge ${pnlBadge}">$${t.pnl.toFixed(2)}</span>` : '-'}</td>
                        <td><span class="badge ${statusBadge}">${t.status}</span></td>
                        <td>${new Date(t.entry_time).toLocaleString()}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Load Portfolio - OPTIMIZED with caching (5 min cache)
        async function loadPortfolio(refresh = false) {
            const container = document.getElementById('portfolio-content');
            if (!refresh) showLoading('portfolio-content');

            try {
                const portfolio = await cachedFetch('/portfolio/latest', { forceRefresh: refresh });
                // Handle missing portfolio gracefully
                if (!portfolio) {
                    container.innerHTML = '<div class="empty-state"><p>No portfolio snapshot found yet. Portfolio is automatically updated when trades are executed - check back soon!</p></div>';
                    return;
                }
                
                displayPortfolio(portfolio, container);
                updateLastUpdated('portfolio');
            } catch (error) {
                // Handle 404 or 503 errors gracefully
                if (error.message.includes('404') || error.message.includes('503')) {
                    container.innerHTML = '<div class="empty-state"><p>No portfolio snapshot found yet. Portfolio is automatically updated when trades are executed - check back soon!</p></div>';
                } else {
                    showError('portfolio-content', error.message);
                }
            }
        }


        // Display portfolio (shared function)
        function displayPortfolio(portfolio, container, isDemo = false) {
            const dailyPnlClass = portfolio.daily_pnl && portfolio.daily_pnl > 0 ? 'text-success' : 
                                  portfolio.daily_pnl && portfolio.daily_pnl < 0 ? 'text-danger' : '';
            const unrealizedPnlClass = portfolio.unrealized_pnl && portfolio.unrealized_pnl > 0 ? 'text-success' : 
                                       portfolio.unrealized_pnl && portfolio.unrealized_pnl < 0 ? 'text-danger' : '';
            const realizedPnlClass = portfolio.realized_pnl && portfolio.realized_pnl > 0 ? 'text-success' : 
                                     portfolio.realized_pnl && portfolio.realized_pnl < 0 ? 'text-danger' : '';
            
            const html = `
                ${isDemo ? '<div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #20c997 100%); margin-bottom: 20px;"><h3>Data Source</h3><div class="value" style="font-size: 1.2em;">Demo Portfolio</div></div>' : ''}
                <div class="stats-grid">
                    <div class="stat-card" style="background: #FFFFFF; border-top: 4px solid #0066FF;">
                        <h3>Total Value</h3>
                        <div class="value" style="font-size: 2em; color: #0066FF;">$${portfolio.total_value.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Cash</h3>
                        <div class="value">$${portfolio.cash.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Positions Value</h3>
                        <div class="value">$${portfolio.positions_value.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Exposure</h3>
                        <div class="value">$${portfolio.total_exposure.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Daily P&L</h3>
                        <div class="value ${dailyPnlClass}">${portfolio.daily_pnl ? `$${portfolio.daily_pnl.toFixed(2)}` : '$0.00'}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Unrealized P&L</h3>
                        <div class="value ${unrealizedPnlClass}">${portfolio.unrealized_pnl ? `$${portfolio.unrealized_pnl.toFixed(2)}` : '$0.00'}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Realized P&L</h3>
                        <div class="value ${realizedPnlClass}">${portfolio.realized_pnl ? `$${portfolio.realized_pnl.toFixed(2)}` : '$0.00'}</div>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: #F8F9FA; border-radius: 8px;">
                    <h3 style="margin-top: 0;">Portfolio Breakdown</h3>
                    <p><strong>Total Value:</strong> Cash ($${portfolio.cash.toFixed(2)}) + Positions ($${portfolio.positions_value.toFixed(2)}) + Unrealized P&L ($${portfolio.unrealized_pnl ? portfolio.unrealized_pnl.toFixed(2) : '0.00'})</p>
                    <p><strong>Total P&L:</strong> Realized ($${portfolio.realized_pnl ? portfolio.realized_pnl.toFixed(2) : '0.00'}) + Unrealized ($${portfolio.unrealized_pnl ? portfolio.unrealized_pnl.toFixed(2) : '0.00'}) = <strong>$${((portfolio.realized_pnl || 0) + (portfolio.unrealized_pnl || 0)).toFixed(2)}</strong></p>
                    <p style="margin-bottom: 0; color: #6B7280;">
                        <strong>Last updated:</strong> ${new Date(portfolio.snapshot_time).toLocaleString()}
                    </p>
                </div>
            `;
            container.innerHTML = html;
        }

        // Load Analytics Dashboard - OPTIMIZED with caching
        async function loadAnalytics(refresh = false) {
            const container = document.getElementById('analytics-content');
            if (!refresh) showLoading('analytics-content');

            try {
                const paperTrading = document.getElementById('analytics-paper-trading')?.checked || false;
                const url = `/analytics/dashboard-summary?paper_trading=${paperTrading}`;
                const params = { paper_trading: paperTrading };
                const analytics = await cachedFetch(url, { forceRefresh: refresh }, params);
                displayAnalytics(analytics, container);
                updateLastUpdated('analytics');
            } catch (error) {
                showError('analytics-content', error.message);
            }
        }

        // Display Analytics
        function displayAnalytics(analytics, container) {
            const html = `
                <div class="stats-grid">
                    <div class="stat-card" style="background: #FFFFFF; border-top: 4px solid #0066FF;">
                        <h3>Total Predictions</h3>
                        <div class="value" style="font-size: 2em; color: #0066FF;">${analytics.total_predictions || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Signals</h3>
                        <div class="value">${analytics.total_signals || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Trades</h3>
                        <div class="value">${analytics.total_trades || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Win Rate</h3>
                        <div class="value">${analytics.win_rate ? (analytics.win_rate * 100).toFixed(1) + '%' : 'N/A'}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Average Edge</h3>
                        <div class="value">${analytics.average_edge ? (analytics.average_edge * 100).toFixed(2) + '%' : 'N/A'}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total P&L</h3>
                        <div class="value ${analytics.total_pnl && analytics.total_pnl > 0 ? 'text-success' : analytics.total_pnl && analytics.total_pnl < 0 ? 'text-danger' : ''}">
                            ${analytics.total_pnl ? '$' + analytics.total_pnl.toFixed(2) : '$0.00'}
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Sharpe Ratio</h3>
                        <div class="value">${analytics.sharpe_ratio ? analytics.sharpe_ratio.toFixed(2) : 'N/A'}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Max Drawdown</h3>
                        <div class="value ${analytics.max_drawdown && analytics.max_drawdown < 0 ? 'text-danger' : ''}">
                            ${analytics.max_drawdown ? (analytics.max_drawdown * 100).toFixed(2) + '%' : 'N/A'}
                        </div>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: #F8F9FA; border-radius: 8px;">
                    <h3 style="margin-top: 0;">Performance Metrics</h3>
                    <p><strong>Prediction Accuracy:</strong> ${analytics.prediction_accuracy ? (analytics.prediction_accuracy * 100).toFixed(1) + '%' : 'N/A'}</p>
                    <p><strong>Signal-to-Trade Conversion:</strong> ${analytics.signal_to_trade_conversion ? (analytics.signal_to_trade_conversion * 100).toFixed(1) + '%' : 'N/A'}</p>
                    <p><strong>Average Confidence:</strong> ${analytics.average_confidence ? (analytics.average_confidence * 100).toFixed(1) + '%' : 'N/A'}</p>
                    <p style="margin-bottom: 0; color: #6B7280;">
                        <strong>Data Source:</strong> ${document.getElementById('analytics-paper-trading')?.checked ? 'Paper Trading' : 'Real Trading'}
                    </p>
                </div>
            `;
            container.innerHTML = html;
        }

        // Load Alerts - OPTIMIZED with caching
        async function loadAlerts(refresh = false) {
            const container = document.getElementById('alerts-content');
            if (!refresh) showLoading('alerts-content');

            try {
                const alerts = await cachedFetch('/alerts', { forceRefresh: refresh });
                displayAlerts(alerts, container);
                updateLastUpdated('alerts');
            } catch (error) {
                showError('alerts-content', error.message);
            }
        }

        // Display Alerts
        function displayAlerts(alerts, container) {
            if (!alerts || alerts.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No alerts configured yet. Click "Create New Alert" to set up notifications for high-confidence signals.</p></div>';
                return;
            }

            let html = '<div class="table-container"><table><thead><tr><th>Type</th><th>Method</th><th>Target</th><th>Status</th><th>Triggered</th><th>Actions</th></tr></thead><tbody>';
            
            alerts.forEach(alert => {
                const statusBadge = alert.enabled ? 'badge-success' : 'badge-secondary';
                html += `
                    <tr>
                        <td><span class="badge">${alert.alert_type}</span></td>
                        <td>${alert.notification_method}</td>
                        <td>${alert.notification_target.substring(0, 30)}${alert.notification_target.length > 30 ? '...' : ''}</td>
                        <td><span class="badge ${statusBadge}">${alert.enabled ? 'Enabled' : 'Disabled'}</span></td>
                        <td>${alert.trigger_count || 0} times</td>
                        <td>
                            <button class="btn" style="padding: 6px 12px; font-size: 0.9em;" onclick="toggleAlert(${alert.id}, ${!alert.enabled})">
                                ${alert.enabled ? 'Disable' : 'Enable'}
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Show Create Alert Form
        function showCreateAlertForm() {
            const container = document.getElementById('alerts-content');
            container.innerHTML = `
                <div style="background: #FFFFFF; padding: 30px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3>Create New Alert</h3>
                    <form onsubmit="createAlert(event)">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Alert Type</label>
                            <select id="alert-type" required style="width: 100%; padding: 12px;">
                                <option value="SIGNAL">Signal Alert</option>
                                <option value="PORTFOLIO">Portfolio Alert</option>
                                <option value="PREDICTION">Prediction Alert</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Notification Method</label>
                            <select id="alert-method" required style="width: 100%; padding: 12px;">
                                <option value="WEBHOOK">Webhook</option>
                                <option value="EMAIL">Email</option>
                                <option value="TELEGRAM">Telegram</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Target (URL/Email/Telegram ID)</label>
                            <input type="text" id="alert-target" required style="width: 100%; padding: 12px;" placeholder="https://your-webhook-url.com or email@example.com">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn">Create Alert</button>
                            <button type="button" class="btn btn-secondary" onclick="loadAlerts()">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        // Create Alert
        async function createAlert(event) {
            event.preventDefault();
            try {
                const response = await fetch(`${API_BASE}/alerts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        alert_type: document.getElementById('alert-type').value,
                        notification_method: document.getElementById('alert-method').value,
                        notification_target: document.getElementById('alert-target').value,
                        alert_rule: { min_edge: 0.1, min_confidence: 0.6 },
                        enabled: true
                    })
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                loadAlerts();
            } catch (error) {
                alert('Failed to create alert: ' + error.message);
            }
        }

        // Toggle Alert
        async function toggleAlert(alertId, enabled) {
            try {
                const endpoint = enabled ? 'enable' : 'disable';
                const response = await fetch(`${API_BASE}/alerts/${alertId}/${endpoint}`, { method: 'PUT' });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                loadAlerts();
            } catch (error) {
                alert('Failed to toggle alert: ' + error.message);
            }
        }

        // Whale Tracker Functions
        let currentWhaleTab = 'leaderboard';

        function switchWhaleTab(tab) {
            currentWhaleTab = tab;
            
            // Update button styles
            document.querySelectorAll('[id^="whales-tab-"]').forEach(btn => {
                btn.style.background = '#F8F9FA';
                btn.style.color = '#6B7280';
                btn.style.border = '1px solid #F1F3F5';
            });
            
            const activeBtn = document.getElementById(`whales-tab-${tab}`);
            if (activeBtn) {
                activeBtn.style.background = '#0066FF';
                activeBtn.style.color = 'white';
                activeBtn.style.border = 'none';
            }
            
            // Show/hide content
            document.getElementById('whales-leaderboard-content').style.display = tab === 'leaderboard' ? 'block' : 'none';
            document.getElementById('whales-activity-content').style.display = tab === 'activity' ? 'block' : 'none';
            document.getElementById('whales-alerts-content').style.display = tab === 'alerts' ? 'block' : 'none';
            
            // Load data for active tab
            loadWhales();
        }

        async function loadWhales(refresh = false) {
            const tab = currentWhaleTab;
            
            if (tab === 'leaderboard') {
                const container = document.getElementById('whales-leaderboard-content');
                if (!refresh) showLoading('whales-leaderboard-content');
                
                try {
                    const data = await cachedFetch('/whales/leaderboard?limit=50', { forceRefresh: refresh });
                    console.log('Whale leaderboard data:', data);
                    if (Array.isArray(data)) {
                        displayWhaleLeaderboard(data, container);
                    } else {
                        console.error('Invalid whale data format:', data);
                        showError('whales-leaderboard-content', 'Invalid data format received');
                    }
                    updateLastUpdated('whales');
                } catch (error) {
                    console.error('Failed to load whale leaderboard:', error);
                    showError('whales-leaderboard-content', error.message);
                }
            } else if (tab === 'activity') {
                const container = document.getElementById('whales-activity-content');
                if (!refresh) showLoading('whales-activity-content');
                
                try {
                    const data = await cachedFetch('/whales/recent-activity?hours=24&min_value=1000', { forceRefresh: refresh });
                    displayWhaleActivity(data, container);
                    updateLastUpdated('whales');
                } catch (error) {
                    showError('whales-activity-content', error.message);
                }
            } else if (tab === 'alerts') {
                const container = document.getElementById('whales-alerts-content');
                if (!refresh) showLoading('whales-alerts-content');
                
                try {
                    const data = await cachedFetch('/whales/alerts?unread_only=true', { forceRefresh: refresh });
                    displayWhaleAlerts(data, container);
                    updateLastUpdated('whales');
                } catch (error) {
                    showError('whales-alerts-content', error.message);
                }
            }
        }

        function displayWhaleLeaderboard(whales, container) {
            if (!whales || whales.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No whale data available yet. The system is discovering and indexing top traders...</p></div>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            whales.forEach((whale, index) => {
                const rankEmoji = whale.rank === 1 ? 'ü•á' : whale.rank === 2 ? 'ü•à' : whale.rank === 3 ? 'ü•â' : '';
                const hoursText = whale.hours_since_trade < 1 ? 'Active now' : `${Math.floor(whale.hours_since_trade)}h ago`;
                
                html += `
                    <div class="market-card" style="margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                            <!-- Rank Badge -->
                            <div style="width: 60px; text-align: center; flex-shrink: 0;">
                                ${rankEmoji ? `<span style="font-size: 2em;">${rankEmoji}</span>` : `<div style="font-size: 1.5em; font-weight: 700; color: #0066FF;">#${whale.rank}</div>`}
                            </div>
                            
                            <!-- Whale Info -->
                            <div style="flex: 1; min-width: 200px;">
                                <div style="font-weight: 700; color: #1A1A1A; margin-bottom: 4px; font-size: 1.1em;">
                                    ${whale.nickname}
                                </div>
                                <div style="font-size: 0.85em; color: #6B7280; font-family: monospace;">
                                    ${whale.wallet_address.slice(0, 10)}...${whale.wallet_address.slice(-8)}
                                </div>
                            </div>
                            
                            <!-- Stats Grid -->
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; flex: 2; min-width: 400px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">Volume</div>
                                    <div style="font-weight: 700; color: #1A1A1A;">$${(whale.total_volume / 1000).toFixed(0)}K</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">Trades</div>
                                    <div style="font-weight: 700; color: #1A1A1A;">${whale.total_trades}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">Win Rate</div>
                                    <div style="font-weight: 700; color: #10B981;">${whale.win_rate.toFixed(1)}%</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 0.75em; color: #6B7280; margin-bottom: 4px;">P&L</div>
                                    <div style="font-weight: 700; color: ${whale.total_profit >= 0 ? '#10B981' : '#EF4444'};">
                                        ${whale.total_profit >= 0 ? '+' : ''}$${whale.total_profit.toFixed(0)}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Last Activity -->
                            <div style="text-align: right; min-width: 100px; flex-shrink: 0;">
                                <div style="font-size: 0.85em; color: #6B7280;">
                                    ${hoursText}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayWhaleActivity(trades, container) {
            if (!trades || trades.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No recent whale activity found. Large trades will appear here when detected.</p></div>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            trades.forEach((trade, index) => {
                const actionColor = trade.action.includes('BUY') ? '#10B981' : '#EF4444';
                const actionBg = trade.action.includes('BUY') ? '#d1fae5' : '#fee2e2';
                const actionText = trade.action.includes('BUY') ? '#065f46' : '#991b1b';
                const hoursText = trade.hours_ago < 1 ? 'Just now' : `${Math.floor(trade.hours_ago)}h ago`;
                
                html += `
                    <div class="market-card" style="margin-bottom: 16px;">
                        <div style="display: flex; align-items: start; gap: 16px;">
                            <!-- Indicator Bar -->
                            <div style="width: 4px; height: 100%; background: ${actionColor}; border-radius: 2px; min-height: 60px; flex-shrink: 0;"></div>
                            
                            <div style="flex: 1;">
                                <!-- Header -->
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; flex-wrap: wrap; gap: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                        <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                                            ${trade.whale_nickname}
                                        </span>
                                        <span style="padding: 4px 12px; background: ${actionBg}; color: ${actionText}; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                                            ${trade.action}
                                        </span>
                                        <span style="font-size: 0.85em; color: #6B7280;">
                                            ${hoursText}
                                        </span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: 700; color: #1A1A1A; font-size: 1.1em;">
                                            $${trade.value.toLocaleString()}
                                        </div>
                                        <div style="font-size: 0.85em; color: #6B7280;">
                                            @${(trade.price * 100).toFixed(1)}%
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Market -->
                                <div style="font-weight: 600; color: #1A1A1A; font-size: 0.95em;">
                                    ${trade.market}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayWhaleAlerts(data, container) {
            const alerts = data.alerts || [];
            
            if (alerts.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No whale alerts yet. You\'ll be notified when whales make large trades.</p></div>';
                return;
            }

            let html = `
                <div style="margin-bottom: 16px; padding: 12px; background: #E6F0FF; border-left: 4px solid #0066FF; border-radius: 8px;">
                    <strong>${data.unread_count || 0} unread alerts</strong>
                </div>
                <div style="display: flex; flex-direction: column; gap: 12px;">
            `;
            
            alerts.forEach(alert => {
                html += `
                    <div class="market-card" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                                    <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                                        ${alert.whale_nickname}
                                    </span>
                                    <span style="padding: 4px 12px; background: #fef3c7; color: #92400e; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                                        Large Trade
                                    </span>
                                    <span style="font-size: 0.85em; color: #6B7280;">
                                        ${new Date(alert.time).toLocaleString()}
                                    </span>
                                </div>
                                <div style="font-weight: 600; color: #1A1A1A; margin-bottom: 4px;">
                                    ${alert.market}
                                </div>
                                <div style="font-size: 0.9em; color: #6B7280;">
                                    ${alert.action} - $${alert.value.toLocaleString()}
                                </div>
                            </div>
                            ${!alert.is_read ? `<button class="btn btn-secondary" onclick="markWhaleAlertRead(${alert.id})" style="padding: 8px 16px; font-size: 0.85em;">Mark Read</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        async function markWhaleAlertRead(alertId) {
            try {
                await fetch(`${API_BASE}/whales/alerts/${alertId}/read`, { method: 'POST' });
                loadWhales(true); // Refresh
            } catch (error) {
                console.error('Failed to mark alert as read:', error);
            }
        }

        // Economic Calendar Functions
        let currentCalendarFilter = 'all';

        function setCalendarFilter(filter) {
            currentCalendarFilter = filter;
            
            // Update button styles
            document.querySelectorAll('[id^="calendar-filter-"]').forEach(btn => {
                btn.style.background = '#F8F9FA';
                btn.style.color = '#6B7280';
                btn.style.border = '1px solid #F1F3F5';
            });
            
            const activeBtn = document.getElementById(`calendar-filter-${filter}`);
            if (activeBtn) {
                activeBtn.style.background = '#0066FF';
                activeBtn.style.color = 'white';
                activeBtn.style.border = 'none';
            }
            
            // Reload calendar with filter
            loadCalendar();
        }

        async function loadCalendar(refresh = false) {
            const container = document.getElementById('calendar-content');
            if (!container) {
                console.error('Calendar content container not found');
                return;
            }
            
            if (!refresh) showLoading('calendar-content');
            
            try {
                // Use 365 days to show all upcoming events (events start ~10 days away)
                const daysParam = '?days=365';
                const filterParam = currentCalendarFilter === 'all' ? '' : `&event_types=${currentCalendarFilter}`;
                const data = await cachedFetch(`/calendar/upcoming${daysParam}${filterParam}`, { forceRefresh: refresh });
                console.log('Calendar events data:', data);
                if (Array.isArray(data)) {
                    displayCalendar(data, container);
                } else {
                    console.error('Invalid calendar data format:', data);
                    showError('calendar-content', 'Invalid data format received');
                }
                updateLastUpdated('calendar');
            } catch (error) {
                console.error('Failed to load calendar:', error);
                showError('calendar-content', error.message || 'Failed to load calendar events');
            }
        }

        function displayCalendar(events, container) {
            if (!container) {
                console.error('Calendar container is null');
                return;
            }
            
            if (!events || events.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 12px; border: 1px solid #F1F3F5;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üìÖ</div>
                        <h3 style="color: #1A1A1A; margin-bottom: 12px; font-size: 1.5em;">No Economic Events Found</h3>
                        <p style="color: #6B7280; margin-bottom: 24px; max-width: 500px; margin-left: auto; margin-right: auto;">
                            The calendar may need to be initialized. Click the button below to initialize the 2026 economic calendar.
                        </p>
                        <button class="btn btn-primary" onclick="initializeCalendar()" style="margin-right: 12px;">üöÄ Initialize Calendar</button>
                        <button class="btn btn-secondary" onclick="loadCalendar(true)">üîÑ Refresh</button>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            events.forEach((event, index) => {
                const importanceColors = {
                    'HIGH': { bg: '#fee2e2', text: '#991b1b', border: '#fca5a5' },
                    'MEDIUM': { bg: '#fef3c7', text: '#92400e', border: '#fcd34d' },
                    'LOW': { bg: '#d1fae5', text: '#065f46', border: '#6ee7b7' }
                };
                const color = importanceColors[event.importance] || importanceColors.MEDIUM;
                
                const typeIcons = {
                    'FOMC': 'üè¶',
                    'CPI': 'üìà',
                    'NFP': 'üë•',
                    'GDP': 'üí∞',
                    'RETAIL': 'üõí',
                    'HOUSING': 'üè†'
                };
                const icon = typeIcons[event.event_type] || 'üìÖ';
                
                const daysText = event.days_until === 0 ? 'Today' : 
                                event.days_until === 1 ? 'Tomorrow' :
                                `${Math.floor(event.days_until)} days away`;
                
                const eventDate = new Date(event.event_date);
                
                html += `
                    <div class="market-card" style="margin-bottom: 16px; cursor: pointer;" onclick="loadEventMarkets(${event.id})">
                        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                            <!-- Event Icon -->
                            <div style="font-size: 3em; flex-shrink: 0;">
                                ${icon}
                            </div>
                            
                            <!-- Event Details -->
                            <div style="flex: 1; min-width: 300px;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                                    <span style="padding: 4px 12px; background: ${color.bg}; color: ${color.text}; border: 1px solid ${color.border}; border-radius: 12px; font-size: 0.85em; font-weight: 700;">
                                        ${event.importance}
                                    </span>
                                    <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                                        ${event.event_type}
                                    </span>
                                    <span style="font-size: 0.85em; color: #6B7280;">
                                        ${daysText}
                                    </span>
                                </div>
                                
                                <h3 style="font-size: 1.1em; font-weight: 700; color: #1A1A1A; margin-bottom: 8px;">
                                    ${event.event_name}
                                </h3>
                                
                                <div style="display: flex; align-items: center; gap: 16px; font-size: 0.9em; color: #6B7280; flex-wrap: wrap;">
                                    <div>
                                        üìÖ ${eventDate.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' })}
                                    </div>
                                    <div>
                                        üïê ${eventDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                </div>
                                
                                ${event.description ? `<div style="margin-top: 8px; font-size: 0.85em; color: #6B7280;">${event.description}</div>` : ''}
                            </div>
                            
                            <!-- Related Markets Count -->
                            <div style="text-align: center; min-width: 100px; flex-shrink: 0;">
                                <div style="font-size: 2em; font-weight: 700; color: #0066FF;">
                                    ${event.related_markets_count || 0}
                                </div>
                                <div style="font-size: 0.85em; color: #6B7280;">
                                    Related Markets
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        async function loadEventMarkets(eventId) {
            try {
                const data = await cachedFetch(`/calendar/event/${eventId}/markets`);
                showEventDetailsModal(data);
            } catch (error) {
                console.error('Failed to load event markets:', error);
                alert('Failed to load event details: ' + error.message);
            }
        }

        function showEventDetailsModal(data) {
            const event = data.event;
            const markets = data.related_markets || [];
            
            let marketsHtml = '';
            if (markets.length === 0) {
                marketsHtml = '<div class="empty-state"><p>No related markets found for this event.</p></div>';
            } else {
                marketsHtml = '<div style="display: flex; flex-direction: column; gap: 8px;">';
                markets.forEach(market => {
                    marketsHtml += `
                        <div style="padding: 12px; background: #F8F9FA; border-radius: 8px; border-left: 3px solid #0066FF;">
                            <div style="display: flex; justify-content: space-between; align-items: start; gap: 12px; flex-wrap: wrap;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #1A1A1A; margin-bottom: 4px; font-size: 0.95em;">
                                        ${market.question}
                                    </div>
                                    <div style="font-size: 0.85em; color: #6B7280;">
                                        Relevance: ${(market.relevance * 100).toFixed(0)}%
                                    </div>
                                    ${market.impact_prediction ? `<div style="font-size: 0.8em; color: #6B7280; margin-top: 4px; font-style: italic;">${market.impact_prediction}</div>` : ''}
                                </div>
                                <div style="text-align: right; min-width: 80px;">
                                    <div style="font-weight: 700; color: #0066FF; font-size: 1.1em;">
                                        ${(market.price * 100).toFixed(1)}%
                                    </div>
                                    <div style="font-size: 0.75em; color: #6B7280;">
                                        Probability
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                marketsHtml += '</div>';
            }
            
            const modalHtml = `
                <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; padding: 20px; z-index: 1000;"
                     onclick="closeEventModal(event)">
                    <div style="background: white; border-radius: 12px; padding: 24px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto;"
                         onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                            <div>
                                <h2 style="font-size: 1.5em; font-weight: 700; color: #1A1A1A; margin-bottom: 8px;">
                                    ${event.name}
                                </h2>
                                <div style="font-size: 0.9em; color: #6B7280;">
                                    üìÖ ${new Date(event.date).toLocaleString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' })}
                                </div>
                            </div>
                            <button onclick="closeEventModal(event)" 
                                    style="background: #F8F9FA; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.2em; color: #6B7280;">
                                ‚úï
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h3 style="font-size: 1.1em; font-weight: 600; color: #1A1A1A; margin-bottom: 12px;">
                                Related Markets (${markets.length})
                            </h3>
                            ${marketsHtml}
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('event-details-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to page
            const modal = document.createElement('div');
            modal.id = 'event-details-modal';
            modal.innerHTML = modalHtml;
            document.body.appendChild(modal);
        }

        function closeEventModal(event) {
            event.stopPropagation();
            const modal = document.getElementById('event-details-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Smooth scroll for anchor links in Help & FAQ
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSmoothScroll);
        } else {
            initSmoothScroll();
        }
        
        function initSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const href = this.getAttribute('href');
                    if (href && href !== '#') {
                        try {
                            const target = document.querySelector(href);
                            if (target) {
                                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        } catch (error) {
                            console.warn('Smooth scroll error:', error);
                        }
                    }
                });
            });
        }

        // Wallet Connection Functions
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('MetaMask is not installed. Please install MetaMask to continue.');
                window.open('https://metamask.io/', '_blank');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length > 0) {
                    const address = accounts[0];
                    localStorage.setItem('walletAddress', address);
                    localStorage.setItem('walletProvider', 'metamask');
                    updateWalletStatus(address);
                    alert('Wallet connected successfully!');
                }
            } catch (error) {
                console.error('Error connecting wallet:', error);
                alert('Failed to connect wallet. Please try again.');
            }
        }

        function updateWalletStatus(address) {
            const statusText = document.getElementById('wallet-status-text');
            if (statusText && address) {
                statusText.innerHTML = `‚úÖ Connected: <strong>${address.substring(0, 6)}...${address.substring(address.length - 4)}</strong>`;
                statusText.style.color = '#10b981';
            }
        }

        function checkWalletConnection() {
            const address = localStorage.getItem('walletAddress');
            if (address) {
                updateWalletStatus(address);
            }
        }

        // Toggle Live Mode
        function toggleLiveMode() {
            const liveMode = document.getElementById('live-mode').checked;
            const modeStatus = document.getElementById('mode-status');
            const fundingInfo = document.getElementById('funding-mode-info');
            const depositBtn = document.getElementById('deposit-btn');
            const currentModeDisplay = document.getElementById('current-mode-display');
            const simulationLabel = document.getElementById('simulation-label');
            const simulationItem1 = document.getElementById('simulation-item-1');
            const simulationItem2 = document.getElementById('simulation-item-2');

            localStorage.setItem('liveMode', liveMode ? 'true' : 'false');

            if (liveMode) {
                modeStatus.innerHTML = '<strong>‚úÖ Live Mode Active:</strong> Real MetaMask connection and real deposits/trades enabled. Make sure your wallet is connected!';
                modeStatus.style.background = '#E6F0FF';
                modeStatus.style.color = '#10b981';
                fundingInfo.innerHTML = '<p style="margin: 0; color: #10b981;"><strong>Live Mode:</strong> Deposits will be processed through your connected MetaMask wallet. Real funds will be transferred.</p>';
                fundingInfo.style.background = '#E6F0FF';
                fundingInfo.style.borderLeftColor = '#10b981';
                depositBtn.textContent = 'Deposit Funds (Real)';
                depositBtn.style.background = '#ef4444';
                currentModeDisplay.textContent = 'Live Mode (Real Trading)';
                simulationLabel.innerHTML = '<strong>‚úÖ Real (Live Mode):</strong>';
                simulationItem1.textContent = 'Fund deposits (real MetaMask transactions)';
                simulationItem2.textContent = 'Trade execution (real Polymarket trades)';
            } else {
                modeStatus.innerHTML = '<strong>‚ö†Ô∏è Test Mode Active:</strong> Deposits and trades are simulated. Perfect for testing with $100!';
                modeStatus.style.background = '#E6F0FF';
                modeStatus.style.color = '#f59e0b';
                fundingInfo.innerHTML = '<p style="margin: 0; color: #0066FF;"><strong>Test Mode:</strong> Simulate deposits to test the system. Start with $100 to see how it works!</p>';
                fundingInfo.style.background = '#E6F0FF';
                fundingInfo.style.borderLeftColor = '#2196F3';
                depositBtn.textContent = 'Deposit Funds (Simulated)';
                depositBtn.style.background = '#10b981';
                currentModeDisplay.textContent = 'Test Mode (Simulated)';
                simulationLabel.innerHTML = '<strong>‚ö†Ô∏è Simulated (Test Mode):</strong>';
                simulationItem1.textContent = 'Fund deposits (simulated for testing)';
                simulationItem2.textContent = 'Trade execution (simulated for testing)';
            }
        }

        // Deposit Funds Function
        async function depositFunds() {
            const amount = document.getElementById('deposit-amount').value;
            const liveMode = localStorage.getItem('liveMode') === 'true';
            const walletAddress = localStorage.getItem('walletAddress');
            
            if (liveMode && !walletAddress) {
                alert('Please connect your wallet first!');
                return;
            }

            if (!amount || parseFloat(amount) < 10) {
                alert('Please enter a valid amount (minimum $10)');
                return;
            }

            const statusEl = document.getElementById('deposit-status');
            
            if (liveMode) {
                // Real deposit flow
                statusEl.textContent = 'Connecting to MetaMask...';
                statusEl.style.color = '#0066FF';
                
                try {
                    // Request transaction from MetaMask
                    const txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: walletAddress,
                            to: '0x...', // Your contract address (would be real in production)
                            value: '0x0', // USDC transfer would be different
                            data: '0x...' // Deposit function call
                        }]
                    });
                    
                    statusEl.textContent = `‚úÖ Real deposit initiated! Transaction: ${txHash.substring(0, 10)}...`;
                    statusEl.style.color = '#10b981';
                    alert('Real deposit transaction sent to MetaMask. Please confirm in your wallet.');
                } catch (error) {
                    statusEl.textContent = '‚ùå Deposit failed. Please try again.';
                    statusEl.style.color = '#ef4444';
                    console.error('Deposit error:', error);
                }
            } else {
                // Simulated deposit flow
                statusEl.textContent = 'Processing simulated deposit...';
                statusEl.style.color = '#0066FF';

                setTimeout(() => {
                    statusEl.textContent = `‚úÖ Successfully simulated deposit of $${amount}! Your test account balance has been updated.`;
                    statusEl.style.color = '#10b981';
                    // Update test balance in localStorage
                    const currentBalance = parseFloat(localStorage.getItem('testBalance') || '0');
                    localStorage.setItem('testBalance', (currentBalance + parseFloat(amount)).toString());
                }, 2000);
            }
        }

        // Load Dashboard Stats - OPTIMIZED with caching
        async function loadDashboardStats() {
            try {
                const data = await cachedFetch('/dashboard/stats');
                
                const portfolioValue = data.portfolio_value || 10000;
                const portfolioChange = data.portfolio_change || 0;
                const changePct = data.portfolio_change_pct || 0;
                
                // Update hero section
                const heroValueEl = document.getElementById('hero-portfolio-value');
                if (heroValueEl) {
                    heroValueEl.textContent = `$${portfolioValue.toLocaleString()}`;
                }
                
                const heroChangeEl = document.getElementById('hero-portfolio-change');
                const heroChangeTextEl = document.getElementById('hero-portfolio-change-text');
                if (heroChangeEl && heroChangeTextEl) {
                    heroChangeTextEl.textContent = `${changePct >= 0 ? '+' : ''}$${Math.abs(portfolioChange).toFixed(2)} (${changePct >= 0 ? '+' : ''}${changePct.toFixed(2)}%)`;
                    heroChangeEl.className = `hero-portfolio-change ${changePct >= 0 ? 'positive' : 'negative'}`;
                }
                
                // Update quick stats
                const statPortfolioValueEl = document.getElementById('stat-portfolio-value');
                if (statPortfolioValueEl) {
                    statPortfolioValueEl.textContent = `$${portfolioValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                }
                
                const changeEl = document.getElementById('stat-portfolio-change');
                if (changeEl) {
                    changeEl.textContent = `${changePct >= 0 ? '+' : ''}$${portfolioChange.toFixed(2)} (${changePct.toFixed(1)}%)`;
                    changeEl.style.color = changePct >= 0 ? '#10b981' : '#ef4444';
                }
                
                const activePositionsEl = document.getElementById('stat-active-positions');
                if (activePositionsEl) {
                    activePositionsEl.textContent = data.active_positions || 0;
                }
                
                const pnlEl = document.getElementById('stat-today-pnl');
                const pnl = data.today_pnl || 0;
                if (pnlEl) {
                    pnlEl.textContent = `${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}`;
                    pnlEl.style.color = pnl >= 0 ? '#10b981' : '#ef4444';
                }
                
                const winRateEl = document.getElementById('stat-win-rate');
                if (winRateEl) {
                    winRateEl.textContent = `${(data.win_rate || 0).toFixed(1)}%`;
                }
                
                const statusEl = document.getElementById('stat-bot-status');
                if (statusEl) {
                    statusEl.textContent = `‚óè ${data.bot_status === 'running' ? 'Running' : 'Stopped'}`;
                    statusEl.style.color = data.bot_status === 'running' ? '#10b981' : '#ef4444';
                }
                
            } catch (error) {
                console.error('Failed to load dashboard stats:', error);
            }
        }

        // Load Recent Activity - OPTIMIZED with caching
        async function loadActivity() {
            try {
                const data = await cachedFetch('/dashboard/activity?limit=20', {}, { limit: 20 });
                
                const activityList = document.getElementById('activityList');
                if (!activityList) return;
                
                if (data.activities && data.activities.length > 0) {
                    activityList.innerHTML = data.activities.map(activity => {
                        const time = activity.time ? new Date(activity.time).toLocaleTimeString() : 'Unknown';
                        const timeAgo = activity.time ? getTimeAgo(new Date(activity.time)) : '';
                        
                        if (activity.type === 'trade') {
                            return `
                                <li class="trade">
                                    <span class="time">${timeAgo}</span>
                                    <span class="action">${activity.action}</span>
                                    <span class="market">${activity.market_question || activity.market_id.substring(0, 30)}</span>
                                    <span class="amount">$${activity.amount.toFixed(2)} @ ${activity.price.toFixed(2)}</span>
                                    ${activity.pnl !== null ? `<span class="amount ${activity.pnl >= 0 ? 'positive' : 'negative'}">P&L: $${activity.pnl.toFixed(2)}</span>` : ''}
                                </li>
                            `;
                        } else {
                            return `
                                <li class="signal">
                                    <span class="time">${timeAgo}</span>
                                    <span class="action">${activity.action}</span>
                                    <span class="market">${activity.market_question || activity.market_id.substring(0, 30)}</span>
                                    <span class="edge">Edge: ${activity.edge}%</span>
                                </li>
                            `;
                        }
                    }).join('');
                } else {
                    activityList.innerHTML = '<li style="text-align: center; color: #6B7280; padding: 20px;">No recent activity</li>';
                }
            } catch (error) {
                console.error('Failed to load activity:', error);
                const activityList = document.getElementById('activityList');
                if (activityList) {
                    activityList.innerHTML = '<li style="text-align: center; color: #ef4444; padding: 20px;">Failed to load activity</li>';
                }
            }
        }

        // Helper function to get time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return `${seconds} sec ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} min ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hr ago`;
            const days = Math.floor(hours / 24);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }

        // Load Trading Settings - OPTIMIZED with caching (long cache)
        async function loadTradingSettings() {
            try {
                const data = await cachedFetch('/dashboard/settings');
                
                // Update UI
                document.getElementById('minEdge').value = (data.min_edge * 100).toFixed(0);
                document.getElementById('edgeValue').textContent = `${(data.min_edge * 100).toFixed(0)}%`;
                
                document.getElementById('minConfidence').value = (data.min_confidence * 100).toFixed(0);
                document.getElementById('confidenceValue').textContent = `${(data.min_confidence * 100).toFixed(0)}%`;
                
                document.getElementById('minLiquidity').value = data.min_liquidity || 500;
                document.getElementById('maxPosition').value = data.max_position_size || 100;
                document.getElementById('paperMode').checked = data.paper_trading_mode !== false;
                updatePaperModeStatus();
                
            } catch (error) {
                console.error('Failed to load trading settings:', error);
            }
        }

        // Update Edge Display
        function updateEdgeDisplay(value) {
            document.getElementById('edgeValue').textContent = `${value}%`;
        }

        // Update Confidence Display
        function updateConfidenceDisplay(value) {
            document.getElementById('confidenceValue').textContent = `${value}%`;
        }

        // Update Paper Mode Status
        function updatePaperModeStatus() {
            const checked = document.getElementById('paperMode').checked;
            document.getElementById('paperModeStatus').textContent = checked ? 'Enabled (Safe for testing)' : 'Disabled (LIVE TRADING)';
        }

        // Save Settings
        async function saveSettings() {
            const minEdge = parseFloat(document.getElementById('minEdge').value) / 100;
            const minConfidence = parseFloat(document.getElementById('minConfidence').value) / 100;
            const minLiquidity = parseFloat(document.getElementById('minLiquidity').value);
            const maxPosition = parseFloat(document.getElementById('maxPosition').value);
            const paperTrading = document.getElementById('paperMode').checked;
            
            try {
                const response = await fetch('/dashboard/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        min_edge: minEdge,
                        min_confidence: minConfidence,
                        min_liquidity: minLiquidity,
                        max_position_size: maxPosition,
                        paper_trading_mode: paperTrading
                    })
                });
                
                if (!response.ok) throw new Error('Failed to save settings');
                
                const data = await response.json();
                const statusEl = document.getElementById('settings-status');
                statusEl.textContent = '‚úÖ Settings saved successfully!';
                statusEl.style.color = '#10b981';
                
                setTimeout(() => {
                    statusEl.textContent = '';
                }, 3000);
                
            } catch (error) {
                console.error('Failed to save settings:', error);
                const statusEl = document.getElementById('settings-status');
                statusEl.textContent = '‚ùå Failed to save settings';
                statusEl.style.color = '#ef4444';
            }
        }

        // Save Preferences Function
        function savePreferences() {
            const preferences = {
                tradingMode: document.getElementById('trading-mode').value,
                riskLevel: document.getElementById('risk-level').value,
                maxPosition: parseFloat(document.getElementById('max-position').value) || 200,
                minEdge: parseFloat(document.getElementById('min-edge').value) || 10,
                minConfidence: parseFloat(document.getElementById('min-confidence').value) || 60,
            };

            // Save to localStorage (in production, save to backend)
            localStorage.setItem('tradingPreferences', JSON.stringify(preferences));

            const statusEl = document.getElementById('preferences-status');
            statusEl.textContent = '‚úÖ Preferences saved successfully!';
            statusEl.style.color = '#10b981';

            setTimeout(() => {
                statusEl.textContent = '';
            }, 3000);
        }

        // Load saved preferences
        function loadPreferences() {
            const saved = localStorage.getItem('tradingPreferences');
            if (saved) {
                const prefs = JSON.parse(saved);
                document.getElementById('trading-mode').value = prefs.tradingMode || 'auto';
                document.getElementById('risk-level').value = prefs.riskLevel || 'moderate';
                document.getElementById('max-position').value = prefs.maxPosition || 200;
                document.getElementById('min-edge').value = prefs.minEdge || 10;
                document.getElementById('min-confidence').value = prefs.minConfidence || 60;
            }
            
            // Load live mode setting
            const liveMode = localStorage.getItem('liveMode') === 'true';
            if (document.getElementById('live-mode')) {
                document.getElementById('live-mode').checked = liveMode;
                toggleLiveMode(); // Update UI
            }
        }

        // Auto-refresh intervals (30 seconds)
        const REFRESH_INTERVAL = 30000; // 30 seconds
        
        // Auto-refresh functions
        function startAutoRefresh() {
            // Refresh markets every 30 seconds
            setInterval(() => {
                const el = document.getElementById('markets');
                if (el && el.classList.contains('active')) {
                    loadMarkets(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh predictions every 30 seconds
            setInterval(() => {
                const el = document.getElementById('predictions');
                if (el && el.classList.contains('active')) {
                    loadPredictions(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh signals every 30 seconds
            setInterval(() => {
                const el = document.getElementById('signals');
                if (el && el.classList.contains('active')) {
                    loadSignals(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh trades every 30 seconds
            setInterval(() => {
                const el = document.getElementById('trades');
                if (el && el.classList.contains('active')) {
                    loadTrades(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh portfolio every 30 seconds
            setInterval(() => {
                const el = document.getElementById('portfolio');
                if (el && el.classList.contains('active')) {
                    loadPortfolio(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh analytics every 30 seconds
            setInterval(() => {
                const el = document.getElementById('analytics');
                if (el && el.classList.contains('active')) {
                    loadAnalytics(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh alerts every 30 seconds
            setInterval(() => {
                const el = document.getElementById('alerts');
                if (el && el.classList.contains('active')) {
                    loadAlerts(true);
                }
            }, REFRESH_INTERVAL);
            
            // Refresh whales every 60 seconds (less frequent due to subgraph rate limits)
            setInterval(() => {
                const el = document.getElementById('whales');
                if (el && el.classList.contains('active')) {
                    loadWhales(true);
                }
            }, 60000); // 60 seconds
            
            // Refresh calendar every hour (events don't change frequently)
            setInterval(() => {
                const el = document.getElementById('calendar');
                if (el && el.classList.contains('active')) {
                    loadCalendar(true);
                }
            }, 3600000); // 1 hour
            
            // Refresh dashboard every 30 seconds
            setInterval(() => {
                const el = document.getElementById('dashboard');
                if (el && el.classList.contains('active')) {
                    loadDashboardStats();
                    loadActivity();
                }
            }, REFRESH_INTERVAL);
        }
        
        // Initialize - Show Dashboard by default
        showTab('dashboard'); // Set Dashboard as default active tab
        checkHealth();
        checkWalletConnection();
        loadPreferences();
        loadDashboardStats(); // Load dashboard stats
        loadActivity(); // Load activity feed (only for dashboard)
        loadTradingSettings(); // Load trading settings
        startAutoRefresh(); // Start auto-refresh
        setInterval(checkHealth, 30000); // Check health every 30 seconds
        setInterval(loadDashboardStats, 30000); // Refresh stats every 30 seconds
        
    </script>
</body>
</html>

